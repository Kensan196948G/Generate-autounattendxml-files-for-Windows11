# Windows 11 Sysprepå¿œç­”ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆPowerShellç‰ˆï¼‰
## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †æ›¸

### ç›®æ¬¡
1. [å‰ææ¡ä»¶ã®ç¢ºèª](#å‰ææ¡ä»¶ã®ç¢ºèª)
2. [ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶](#ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶)
3. [ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †](#ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †)
4. [åˆæœŸè¨­å®š](#åˆæœŸè¨­å®š)
5. [å‹•ä½œç¢ºèªæ–¹æ³•](#å‹•ä½œç¢ºèªæ–¹æ³•)
6. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
7. [ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•](#ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•)

---

## å‰ææ¡ä»¶ã®ç¢ºèª

### å¿…è¦ãªçŸ¥è­˜ãƒ»ã‚¹ã‚­ãƒ«
- **PowerShellåŸºæœ¬æ“ä½œ**: PowerShellã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•
- **Windowsç®¡ç†**: Windowsè¨­å®šé …ç›®ã®åŸºæœ¬çš„ãªç†è§£
- **XMLåŸºç¤çŸ¥è­˜**: unattend.xmlãƒ•ã‚¡ã‚¤ãƒ«ã®æ¦‚å¿µç†è§£ï¼ˆæ¨å¥¨ï¼‰

### ä½œæ¥­ç’°å¢ƒãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] ç®¡ç†è€…æ¨©é™ã§ã®ãƒ­ã‚°ã‚¤ãƒ³ãŒå¯èƒ½
- [ ] PowerShellå®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã®å¤‰æ›´ãŒå¯èƒ½
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒã‚ã‚‹ï¼ˆæ¨å¥¨ï¼‰
- [ ] ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã‚½ãƒ•ãƒˆã«ã‚ˆã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãŒãªã„

---

## ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

### ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

#### ã‚µãƒãƒ¼ãƒˆå¯¾è±¡OS
| OS | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ã‚µãƒãƒ¼ãƒˆçŠ¶æ³ |
|---|-----------|-------------|
| Windows 10 | 1809ä»¥é™ | âœ… ãƒ•ãƒ«ã‚µãƒãƒ¼ãƒˆ |
| Windows 11 | å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | âœ… ãƒ•ãƒ«ã‚µãƒãƒ¼ãƒˆ |
| Windows Server 2019 | å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | âœ… ãƒ•ãƒ«ã‚µãƒãƒ¼ãƒˆ |
| Windows Server 2022 | å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | âœ… ãƒ•ãƒ«ã‚µãƒãƒ¼ãƒˆ |

#### PowerShellè¦ä»¶
| é …ç›® | æœ€å°è¦ä»¶ | æ¨å¥¨è¦ä»¶ |
|-----|----------|----------|
| PowerShell ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 5.1 | 5.1 æœ€æ–° |
| .NET Framework | 4.7.2ä»¥é™ | 4.8ä»¥é™ |
| å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ | RemoteSigned | RemoteSigned |

#### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ä»¶
| ãƒªã‚½ãƒ¼ã‚¹ | æœ€å°è¦ä»¶ | æ¨å¥¨è¦ä»¶ | å‚™è€ƒ |
|---------|----------|----------|------|
| CPU | 64bit ãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ | ãƒãƒ«ãƒã‚³ã‚¢ | ä¸¦åˆ—å‡¦ç†ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š |
| ãƒ¡ãƒ¢ãƒª | 4GB | 8GBä»¥ä¸Š | XMLãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«ä¾å­˜ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | 100MBç©ºãå®¹é‡ | 1GBä»¥ä¸Š | ãƒ­ã‚°ã¨ãƒ†ãƒ³ãƒãƒ©ãƒªãƒ•ã‚¡ã‚¤ãƒ«ç”¨ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | ä¸è¦ | ãƒ–ãƒ­ãƒ¼ãƒ‰ãƒãƒ³ãƒ‰æ¥ç¶š | æ›´æ–°ç¢ºèªã¨ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºç”¨ |

---

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

### Step 1: äº‹å‰æº–å‚™

#### 1.1 PowerShellå®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã®ç¢ºèªã¨è¨­å®š
```powershell
# ç¾åœ¨ã®å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèª
Get-ExecutionPolicy -List

# RemoteSignedã«è¨­å®šï¼ˆç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œï¼‰
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope LocalMachine
```

#### 1.2 å¿…è¦ãª.NETã‚¢ã‚»ãƒ³ãƒ–ãƒªã®ç¢ºèª
```powershell
# .NET Framework ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
[System.Environment]::Version

# å¿…è¦ãªã‚¢ã‚»ãƒ³ãƒ–ãƒªã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
Add-Type -AssemblyName System.Xml
Add-Type -AssemblyName System.Security
Write-Host ".NET ã‚¢ã‚»ãƒ³ãƒ–ãƒªã¯æ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ" -ForegroundColor Green
```

#### 1.3 ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
```powershell
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
$InstallPath = "C:\Tools\Windows11-UnattendXML-Generator"
New-Item -Path $InstallPath -ItemType Directory -Force
Set-Location $InstallPath
```

### Step 2: ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨é…ç½®

#### 2.1 ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```powershell
# GitHubã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆä¾‹ï¼‰
# ã¾ãŸã¯æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼

# ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã‚’ç¢ºèª
$RequiredFiles = @(
    "Generate-UnattendXML.ps1",
    "Generate-UnattendXML.psm1",
    "Modules\UserManagement\UserManagement.psm1",
    "Modules\NetworkConfig\NetworkConfig.psm1",
    "Modules\WindowsFeatures\WindowsFeatures.psm1",
    "Modules\ApplicationConfig\ApplicationConfig.psm1",
    "Modules\XMLGenerator\XMLGenerator.psm1",
    "Configs\Presets\Development.psd1",
    "Configs\Presets\Enterprise.psd1",
    "Configs\Presets\Minimal.psd1"
)

foreach ($file in $RequiredFiles) {
    $fullPath = Join-Path $InstallPath $file
    if (Test-Path $fullPath) {
        Write-Host "âœ… $file ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ" -ForegroundColor Green
    } else {
        Write-Host "âŒ $file ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
    }
}
```

#### 2.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®ä½œæˆ
```powershell
# å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
$Directories = @(
    "Configs\Presets",
    "Modules\UserManagement",
    "Modules\NetworkConfig", 
    "Modules\WindowsFeatures",
    "Modules\ApplicationConfig",
    "Modules\XMLGenerator",
    "Outputs",
    "Logs",
    "Tests"
)

foreach ($dir in $Directories) {
    $fullPath = Join-Path $InstallPath $dir
    New-Item -Path $fullPath -ItemType Directory -Force | Out-Null
    Write-Host "ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ: $dir" -ForegroundColor Blue
}
```

### Step 3: æ¨©é™è¨­å®šã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

#### 3.1 ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ã®è¨­å®š
```powershell
# ç®¡ç†è€…ã‚°ãƒ«ãƒ¼ãƒ—ã«é©åˆ‡ãªæ¨©é™ã‚’è¨­å®š
$Path = $InstallPath
$Administrators = [System.Security.Principal.SecurityIdentifier]::new("S-1-5-32-544").Translate([System.Security.Principal.NTAccount])

$AccessRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
    $Administrators,
    "FullControl",
    "ContainerInherit,ObjectInherit",
    "None",
    "Allow"
)

$Acl = Get-Acl $Path
$Acl.SetAccessRule($AccessRule)
Set-Acl $Path $Acl

Write-Host "âœ… ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ãŒè¨­å®šã•ã‚Œã¾ã—ãŸ" -ForegroundColor Green
```

#### 3.2 PowerShellãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¿¡é ¼è¨­å®š
```powershell
# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¿¡é ¼è¨­å®š
$ModulePaths = Get-ChildItem -Path "$InstallPath\Modules" -Recurse -Filter "*.psm1"

foreach ($module in $ModulePaths) {
    # ãƒ‡ã‚¸ã‚¿ãƒ«ç½²åã®ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    $signature = Get-AuthenticodeSignature $module.FullName
    Write-Host "ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: $($module.Name) - ç½²å: $($signature.Status)" -ForegroundColor Yellow
}
```

### Step 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 4.1 PATHç’°å¢ƒå¤‰æ•°ã¸ã®è¿½åŠ 
```powershell
# ã‚·ã‚¹ãƒ†ãƒ PATHã«è¿½åŠ 
$CurrentPath = [Environment]::GetEnvironmentVariable("Path", "Machine")
if ($CurrentPath -notlike "*$InstallPath*") {
    [Environment]::SetEnvironmentVariable(
        "Path", 
        "$CurrentPath;$InstallPath", 
        "Machine"
    )
    Write-Host "âœ… PATHç’°å¢ƒå¤‰æ•°ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ" -ForegroundColor Green
} else {
    Write-Host "âš ï¸ PATHç’°å¢ƒå¤‰æ•°ã¯æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™" -ForegroundColor Yellow
}
```

#### 4.2 PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®è¿½åŠ ï¼ˆæ¨å¥¨ï¼‰
```powershell
# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’è¿½åŠ 
$ProfilePath = $PROFILE.AllUsersAllHosts
if (!(Test-Path $ProfilePath)) {
    New-Item -Path $ProfilePath -Type File -Force
}

$ModulePath = "$InstallPath\Generate-UnattendXML.psm1"
$ImportLine = "Import-Module '$ModulePath' -DisableNameChecking"

$ProfileContent = Get-Content $ProfilePath -ErrorAction SilentlyContinue
if ($ProfileContent -notcontains $ImportLine) {
    Add-Content $ProfilePath $ImportLine
    Write-Host "âœ… PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ" -ForegroundColor Green
}
```

---

## åˆæœŸè¨­å®š

### Step 1: åŸºæœ¬è¨­å®šã®æ§‹æˆ

#### 1.1 ãƒ­ã‚°è¨­å®š
```powershell
# ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åˆæœŸåŒ–
$LogPath = "$InstallPath\Logs"
$MaxLogFiles = 10
$MaxLogSizeMB = 10

# å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
$CleanupScript = @"
`$LogFiles = Get-ChildItem -Path '$LogPath' -Filter '*.log' | Sort-Object LastWriteTime -Descending
if (`$LogFiles.Count -gt $MaxLogFiles) {
    `$LogFiles | Select-Object -Skip $MaxLogFiles | Remove-Item -Force
}
"@

$CleanupScript | Out-File "$InstallPath\Cleanup-Logs.ps1" -Encoding UTF8
```

#### 1.2 å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
```powershell
# å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™è¨­å®š
$OutputPath = "$InstallPath\Outputs"
$Users = [System.Security.Principal.SecurityIdentifier]::new("S-1-5-32-545").Translate([System.Security.Principal.NTAccount])

$AccessRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
    $Users,
    "ReadAndExecute",
    "ContainerInherit,ObjectInherit",
    "None",
    "Allow"
)

$Acl = Get-Acl $OutputPath
$Acl.SetAccessRule($AccessRule)
Set-Acl $OutputPath $Acl
```

### Step 2: ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã®æ¤œè¨¼

#### 2.1 ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´åˆæ€§ç¢ºèª
```powershell
# ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã®æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Test-PresetConfiguration {
    param([string]$PresetPath)
    
    try {
        $config = Import-PowerShellDataFile -Path $PresetPath
        
        # å¿…é ˆé …ç›®ã®ç¢ºèª
        $requiredKeys = @("System", "Users", "Applications")
        foreach ($key in $requiredKeys) {
            if (-not $config.ContainsKey($key)) {
                throw "å¿…é ˆé …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $key"
            }
        }
        
        Write-Host "âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆæ¤œè¨¼æˆåŠŸ: $(Split-Path $PresetPath -Leaf)" -ForegroundColor Green
        return $true
    }
    catch {
        Write-Host "âŒ ãƒ—ãƒªã‚»ãƒƒãƒˆæ¤œè¨¼å¤±æ•—: $(Split-Path $PresetPath -Leaf) - $_" -ForegroundColor Red
        return $false
    }
}

# å…¨ãƒ—ãƒªã‚»ãƒƒãƒˆã®æ¤œè¨¼
$PresetPath = "$InstallPath\Configs\Presets"
$PresetFiles = Get-ChildItem -Path $PresetPath -Filter "*.psd1"

foreach ($preset in $PresetFiles) {
    Test-PresetConfiguration -PresetPath $preset.FullName
}
```

### Step 3: ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 3.1 ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
```powershell
# ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆ
$WshShell = New-Object -ComObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut("$env:PUBLIC\Desktop\Windows11 UnattendXML Generator.lnk")
$Shortcut.TargetPath = "powershell.exe"
$Shortcut.Arguments = "-ExecutionPolicy Bypass -File `"$InstallPath\Generate-UnattendXML.ps1`" -Interactive"
$Shortcut.WorkingDirectory = $InstallPath
$Shortcut.IconLocation = "powershell.exe,0"
$Shortcut.Description = "Windows 11 Sysprep UnattendXML Generator"
$Shortcut.Save()

Write-Host "âœ… ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ" -ForegroundColor Green
```

#### 3.2 ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
```powershell
# ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆ
$StartMenuPath = "$env:ProgramData\Microsoft\Windows\Start Menu\Programs\Administrative Tools"
if (!(Test-Path $StartMenuPath)) {
    New-Item -Path $StartMenuPath -ItemType Directory -Force
}

$Shortcut = $WshShell.CreateShortcut("$StartMenuPath\Windows11 UnattendXML Generator.lnk")
$Shortcut.TargetPath = "powershell.exe"
$Shortcut.Arguments = "-ExecutionPolicy Bypass -File `"$InstallPath\Generate-UnattendXML.ps1`" -Interactive"
$Shortcut.WorkingDirectory = $InstallPath
$Shortcut.IconLocation = "powershell.exe,0"
$Shortcut.Description = "Windows 11 Sysprep UnattendXML Generator"
$Shortcut.Save()

Write-Host "âœ… ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ" -ForegroundColor Green
```

---

## å‹•ä½œç¢ºèªæ–¹æ³•

### Step 1: åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

#### 1.1 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
```powershell
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
Set-Location $InstallPath

# ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ
Import-Module ".\Generate-UnattendXML.psm1" -Force -Verbose

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‹ç¢ºèª
Get-Module | Where-Object Name -eq "Generate-UnattendXML"

Write-Host "âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†" -ForegroundColor Green
```

#### 1.2 ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
```powershell
# å„ãƒ—ãƒªã‚»ãƒƒãƒˆã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
$PresetNames = @("Development", "Enterprise", "Minimal")

foreach ($presetName in $PresetNames) {
    try {
        $config = Import-UnattendPreset -PresetName $presetName
        Write-Host "âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿æˆåŠŸ: $presetName" -ForegroundColor Green
        
        # åŸºæœ¬é …ç›®ã®ç¢ºèª
        Write-Host "   ãƒ›ã‚¹ãƒˆå: $($config.System.HostName)" -ForegroundColor Gray
        Write-Host "   ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $($config.Users.Count)" -ForegroundColor Gray
    }
    catch {
        Write-Host "âŒ ãƒ—ãƒªã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å¤±æ•—: $presetName - $_" -ForegroundColor Red
    }
}
```

#### 1.3 XMLç”Ÿæˆãƒ†ã‚¹ãƒˆï¼ˆWhatIf ãƒ¢ãƒ¼ãƒ‰ï¼‰
```powershell
# WhatIfãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
Write-Host "=== WhatIfãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ===" -ForegroundColor Cyan

try {
    .\Generate-UnattendXML.ps1 -PresetName "Development" -WhatIf -OutputPath ".\Outputs\test.xml"
    Write-Host "âœ… WhatIf ãƒ†ã‚¹ãƒˆæˆåŠŸ" -ForegroundColor Green
}
catch {
    Write-Host "âŒ WhatIf ãƒ†ã‚¹ãƒˆå¤±æ•—: $_" -ForegroundColor Red
}
```

### Step 2: å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆãƒ†ã‚¹ãƒˆ

#### 2.1 Development ãƒ—ãƒªã‚»ãƒƒãƒˆã§ã®ãƒ†ã‚¹ãƒˆ
```powershell
# Developmentè¨­å®šã§XMLç”Ÿæˆãƒ†ã‚¹ãƒˆ
Write-Host "=== Development ãƒ—ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œãƒ†ã‚¹ãƒˆ ===" -ForegroundColor Cyan

try {
    $result = .\Generate-UnattendXML.ps1 -PresetName "Development" -OutputPath ".\Outputs\test-development.xml" -Force
    
    if (Test-Path $result) {
        $xmlContent = Get-Content $result -Raw
        $xmlDoc = [xml]$xmlContent
        
        Write-Host "âœ… XMLç”ŸæˆæˆåŠŸ: $result" -ForegroundColor Green
        Write-Host "   ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: $((Get-Item $result).Length) bytes" -ForegroundColor Gray
        Write-Host "   XMLãƒ«ãƒ¼ãƒˆè¦ç´ : $($xmlDoc.DocumentElement.LocalName)" -ForegroundColor Gray
    } else {
        Write-Host "âŒ ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
    }
}
catch {
    Write-Host "âŒ XMLç”Ÿæˆãƒ†ã‚¹ãƒˆå¤±æ•—: $_" -ForegroundColor Red
}
```

#### 2.2 XMLå¦¥å½“æ€§æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
```powershell
# ç”Ÿæˆã•ã‚ŒãŸXMLãƒ•ã‚¡ã‚¤ãƒ«ã®å¦¥å½“æ€§æ¤œè¨¼
$testXmlPath = ".\Outputs\test-development.xml"

if (Test-Path $testXmlPath) {
    try {
        # XMLãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        [xml]$xmlDoc = Get-Content $testXmlPath -Raw
        
        # åŸºæœ¬çš„ãªæ§‹é€ ç¢ºèª
        $unattendElement = $xmlDoc.unattend
        if ($unattendElement -ne $null) {
            Write-Host "âœ… XMLæ§‹é€ æ¤œè¨¼æˆåŠŸ" -ForegroundColor Green
            Write-Host "   åå‰ç©ºé–“: $($unattendElement.xmlns)" -ForegroundColor Gray
        } else {
            Write-Host "âŒ unattendè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
        }
    }
    catch {
        Write-Host "âŒ XMLå¦¥å½“æ€§æ¤œè¨¼å¤±æ•—: $_" -ForegroundColor Red
    }
}
```

### Step 3: å¯¾è©±å‹ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ

#### 3.1 ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰èµ·å‹•ãƒ†ã‚¹ãƒˆ
```powershell
# ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆï¼ˆæ‰‹å‹•å®Ÿè¡Œï¼‰
Write-Host "=== å¯¾è©±å‹ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ ===" -ForegroundColor Cyan
Write-Host "ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰‹å‹•ã§å®Ÿè¡Œã—ã¦ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„:" -ForegroundColor Yellow
Write-Host ".\Generate-UnattendXML.ps1 -Interactive" -ForegroundColor White
Write-Host ""
Write-Host "æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:" -ForegroundColor Yellow
Write-Host "1. ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º" -ForegroundColor Gray
Write-Host "2. çŸ¢å°ã‚­ãƒ¼ã§ã®é¸æŠæ“ä½œ" -ForegroundColor Gray
Write-Host "3. Enterã‚­ãƒ¼ã§ã®ç¢ºå®š" -ForegroundColor Gray
Write-Host "4. ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã®å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" -ForegroundColor Gray
Write-Host "5. XMLãƒ•ã‚¡ã‚¤ãƒ«ã®æ­£å¸¸ãªç”Ÿæˆ" -ForegroundColor Gray
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### å•é¡Œ1: PowerShellå®Ÿè¡Œãƒãƒªã‚·ãƒ¼ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: 
```
.\Generate-UnattendXML.ps1 : ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡ŒãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ« Generate-UnattendXML.ps1 ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚
```

**è§£æ±ºæ–¹æ³•**:
```powershell
# ç®¡ç†è€…æ¨©é™ã§PowerShellã‚’èµ·å‹•ã—ã¦å®Ÿè¡Œ
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

#### å•é¡Œ2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**:
```
Import-Module : æŒ‡å®šã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'Generate-UnattendXML.psm1' ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸ
```

**è§£æ±ºæ–¹æ³•**:
```powershell
# ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
Test-Path ".\Generate-UnattendXML.psm1"

# æ¨©é™ã®ç¢ºèªã¨ä¿®æ­£
$Path = ".\Generate-UnattendXML.psm1"
$Acl = Get-Acl $Path
$Acl | Format-List

# ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤
Unblock-File $Path
```

#### å•é¡Œ3: .NETã‚¢ã‚»ãƒ³ãƒ–ãƒªèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**:
```
Add-Type : ã‚¢ã‚»ãƒ³ãƒ–ãƒªã¾ãŸã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'System.Xml' ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ
```

**è§£æ±ºæ–¹æ³•**:
```powershell
# .NET Framework ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
[System.Environment]::Version

# Windows Updateã®ç¢ºèªã¨é©ç”¨
# .NET Framework 4.7.2ä»¥é™ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```

#### å•é¡Œ4: ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›æ¨©é™ã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**:
```
Add-Content : ãƒ‘ã‚¹ 'C:\Tools\Windows11-UnattendXML-Generator\Logs\' ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ
```

**è§£æ±ºæ–¹æ³•**:
```powershell
# å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™è¨­å®š
$OutputPath = ".\Outputs"
$LogPath = ".\Logs"

foreach ($path in @($OutputPath, $LogPath)) {
    $Acl = Get-Acl $path
    $AccessRule = New-Object System.Security.AccessControl.FileSystemAccessRule(
        $env:USERNAME, "FullControl", "ContainerInherit,ObjectInherit", "None", "Allow"
    )
    $Acl.SetAccessRule($AccessRule)
    Set-Acl $path $Acl
}
```

### è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```powershell
# çµ±åˆè¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
function Test-UnattendXMLGeneratorInstallation {
    Write-Host "=== Windows 11 UnattendXML Generator è¨ºæ–­ ===" -ForegroundColor Cyan
    
    # PowerShellãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
    Write-Host "PowerShell ãƒãƒ¼ã‚¸ãƒ§ãƒ³: $($PSVersionTable.PSVersion)" -ForegroundColor Green
    
    # å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ç¢ºèª
    Write-Host "å®Ÿè¡Œãƒãƒªã‚·ãƒ¼: $(Get-ExecutionPolicy)" -ForegroundColor Green
    
    # ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
    $RequiredFiles = @(
        "Generate-UnattendXML.ps1",
        "Generate-UnattendXML.psm1"
    )
    
    foreach ($file in $RequiredFiles) {
        if (Test-Path $file) {
            Write-Host "âœ… $file" -ForegroundColor Green
        } else {
            Write-Host "âŒ $file ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
        }
    }
    
    # ãƒ—ãƒªã‚»ãƒƒãƒˆç¢ºèª
    $PresetPath = ".\Configs\Presets\"
    $PresetFiles = @("Development.psd1", "Enterprise.psd1", "Minimal.psd1")
    
    foreach ($preset in $PresetFiles) {
        $fullPath = Join-Path $PresetPath $preset
        if (Test-Path $fullPath) {
            Write-Host "âœ… $preset" -ForegroundColor Green
        } else {
            Write-Host "âŒ $preset ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Red
        }
    }
    
    Write-Host "=== è¨ºæ–­å®Œäº† ===" -ForegroundColor Cyan
}

# è¨ºæ–­å®Ÿè¡Œ
Test-UnattendXMLGeneratorInstallation
```

---

## ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

### Step 1: ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®å‰Šé™¤
```powershell
# ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‰Šé™¤
$DesktopShortcut = "$env:PUBLIC\Desktop\Windows11 UnattendXML Generator.lnk"
if (Test-Path $DesktopShortcut) {
    Remove-Item $DesktopShortcut -Force
    Write-Host "âœ… ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ" -ForegroundColor Green
}

# ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‰Šé™¤
$StartMenuShortcut = "$env:ProgramData\Microsoft\Windows\Start Menu\Programs\Administrative Tools\Windows11 UnattendXML Generator.lnk"
if (Test-Path $StartMenuShortcut) {
    Remove-Item $StartMenuShortcut -Force
    Write-Host "âœ… ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ" -ForegroundColor Green
}
```

### Step 2: ç’°å¢ƒå¤‰æ•°ã®å‰Šé™¤
```powershell
# PATHç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã®å‰Šé™¤
$InstallPath = "C:\Tools\Windows11-UnattendXML-Generator"
$CurrentPath = [Environment]::GetEnvironmentVariable("Path", "Machine")
$NewPath = $CurrentPath -replace [regex]::Escape(";$InstallPath"), ""
[Environment]::SetEnvironmentVariable("Path", $NewPath, "Machine")
Write-Host "âœ… PATHç’°å¢ƒå¤‰æ•°ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ" -ForegroundColor Green
```

### Step 3: PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```powershell
# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¡Œå‰Šé™¤
$ProfilePath = $PROFILE.AllUsersAllHosts
if (Test-Path $ProfilePath) {
    $ProfileContent = Get-Content $ProfilePath
    $CleanContent = $ProfileContent | Where-Object { $_ -notlike "*Generate-UnattendXML*" }
    $CleanContent | Set-Content $ProfilePath
    Write-Host "âœ… PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ" -ForegroundColor Green
}
```

### Step 4: ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®å‰Šé™¤
```powershell
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å‰Šé™¤
if (Test-Path $InstallPath) {
    Remove-Item $InstallPath -Recurse -Force
    Write-Host "âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¾ã—ãŸ: $InstallPath" -ForegroundColor Green
} else {
    Write-Host "âš ï¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $InstallPath" -ForegroundColor Yellow
}

Write-Host "=== ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº† ===" -ForegroundColor Cyan
```

---

## å®Œäº†ç¢ºèª

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæ­£å¸¸ã«å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å‹•ä½œç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ï¼š

```powershell
# åŸºæœ¬çš„ãªå‹•ä½œãƒ†ã‚¹ãƒˆ
.\Generate-UnattendXML.ps1 -PresetName "Development" -WhatIf

# æˆåŠŸæ™‚ã®å‡ºåŠ›ä¾‹:
# WhatIfãƒ¢ãƒ¼ãƒ‰: å®Ÿéš›ã®ç”Ÿæˆã¯è¡Œã‚ãšã€å‡¦ç†å†…å®¹ã®ã¿è¡¨ç¤º
# === ç”Ÿæˆäºˆå®šã®è¨­å®šå†…å®¹ ===
# ãƒ›ã‚¹ãƒˆå: WIN11-DEV
# ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 3
# IPv6ç„¡åŠ¹åŒ–: True
# Firewallç„¡åŠ¹åŒ–: True
# å‡ºåŠ›å…ˆ: C:\Tools\Windows11-UnattendXML-Generator\Outputs\unattend_20250122_143052.xml
# ==========================
```

---

*ã“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †æ›¸ã«å¾“ã£ã¦ã€Windows 11 Sysprepå¿œç­”ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆPowerShellç‰ˆï¼‰ã‚’æ­£å¸¸ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚*