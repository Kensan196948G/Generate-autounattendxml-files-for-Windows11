# PowerShell版 v2.0 設定リファレンス

## 目次
1. [設定ファイル形式](#設定ファイル形式)
2. [全23項目詳細リファレンス](#全23項目詳細リファレンス)
3. [プリセット設定詳細](#プリセット設定詳細)
4. [Context7コンテキスト設定](#context7コンテキスト設定)
5. [詳細設定オプション](#詳細設定オプション)
6. [設定の検証ルール](#設定の検証ルール)

---

## 設定ファイル形式

### サポート形式一覧
| 形式 | 拡張子 | 説明 | 推奨用途 |
|------|--------|------|----------|
| JSON | .json | JavaScript Object Notation | API連携、Web連携 |
| PSD1 | .psd1 | PowerShell Data File | PowerShell環境専用 |
| YAML | .yaml/.yml | YAML Ain't Markup Language | 人間が読みやすい形式 |
| XML | .xml | eXtensible Markup Language | 既存XML設定の再利用 |

### 形式別サンプル

#### JSON形式
```json
{
  "version": "2.0",
  "metadata": {
    "created": "2024-08-24",
    "author": "System Administrator",
    "description": "Enterprise configuration"
  },
  "configuration": {
    "RegionalSettings": {
      "InputLocale": "0411:00000411",
      "SystemLocale": "ja-JP"
    }
  }
}
```

#### PSD1形式
```powershell
@{
    Version = "2.0"
    Metadata = @{
        Created = "2024-08-24"
        Author = "System Administrator"
        Description = "Enterprise configuration"
    }
    Configuration = @{
        RegionalSettings = @{
            InputLocale = "0411:00000411"
            SystemLocale = "ja-JP"
        }
    }
}
```

---

## 全23項目詳細リファレンス

### 1. 地域と言語設定 (RegionalSettings)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| InputLocale | string | Yes | "0411:00000411" | 入力方式識別子 |
| SystemLocale | string | Yes | "ja-JP" | システムロケール |
| UILanguage | string | Yes | "ja-JP" | UI言語 |
| UILanguageFallback | string | No | "en-US" | フォールバック言語 |
| UserLocale | string | Yes | "ja-JP" | ユーザーロケール |

**使用例:**
```powershell
$regionalSettings = @{
    InputLocale = "0411:00000411"  # 日本語キーボード
    SystemLocale = "ja-JP"
    UILanguage = "ja-JP"
    UILanguageFallback = "en-US"
    UserLocale = "ja-JP"
}
```

### 2. プロセッサアーキテクチャ (ProcessorArchitecture)

| 値 | 説明 | 対応OS |
|----|------|--------|
| amd64 | 64ビットプロセッサ | Windows 11全エディション |
| x86 | 32ビットプロセッサ | Windows 10のみ |
| arm64 | ARMプロセッサ | Windows 11 ARM版 |

### 3. セットアップUI設定 (SetupUILanguage)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| UILanguage | string | Yes | "ja-JP" | セットアップUI言語 |
| WillShowUI | string | No | "OnError" | UI表示条件 |

**WillShowUI値:**
- `Never`: UIを表示しない
- `OnError`: エラー時のみ表示
- `Always`: 常に表示

### 4. Windowsエディション (ImageInstall)

| エディション | 説明 | 用途 |
|-------------|------|------|
| Windows 11 Pro | プロフェッショナル版 | 小規模企業、開発者 |
| Windows 11 Enterprise | エンタープライズ版 | 大企業 |
| Windows 11 Education | 教育機関版 | 学校、大学 |
| Windows 11 Pro for Workstations | ワークステーション版 | 高性能PC |

### 5. Windows PE設定 (WindowsPE)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| EnableNetwork | bool | No | true | ネットワーク有効化 |
| EnableFirewall | bool | No | false | ファイアウォール有効化 |
| PageFile | int | No | 512 | ページファイルサイズ(MB) |

### 6. ディスク構成 (DiskConfiguration)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| WillWipeDisk | bool | Yes | true | ディスク初期化 |
| DiskID | int | Yes | 0 | ディスクID |
| PartitionStyle | string | No | "GPT" | パーティションスタイル |

**パーティション設定:**
```powershell
$diskConfig = @{
    WillWipeDisk = $true
    Disk = @{
        DiskID = 0
        PartitionStyle = "GPT"
        Partitions = @(
            @{
                Order = 1
                Size = 500
                Type = "EFI"
                Format = "FAT32"
                Label = "System"
            },
            @{
                Order = 2
                Size = 128
                Type = "MSR"
            },
            @{
                Order = 3
                Extend = $true
                Type = "Primary"
                Format = "NTFS"
                Label = "Windows"
                Letter = "C"
            }
        )
    }
}
```

### 7. コンピューター名設定 (ComputerSettings)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| ComputerName | string | Yes | "DESKTOP-PC" | コンピューター名 |
| JoinDomain | bool | No | false | ドメイン参加 |
| Domain | string | No* | - | ドメイン名 |
| DomainOU | string | No | - | 組織単位 |
| DomainAdmin | string | No* | - | ドメイン管理者 |
| DomainPassword | string | No* | - | ドメインパスワード |
| TimeZone | string | Yes | "Tokyo Standard Time" | タイムゾーン |

*JoinDomain=trueの場合は必須

### 8. ユーザーアカウント (UserAccounts)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| Username | string | Yes | - | ユーザー名 |
| Password | string | Yes | - | パスワード |
| Group | string | Yes | "Users" | グループ |
| Description | string | No | - | 説明 |
| AutoLogon | bool | No | false | 自動ログオン |
| AutoLogonCount | int | No | 1 | 自動ログオン回数 |
| PasswordNeverExpires | bool | No | false | パスワード無期限 |

**複数ユーザー設定例:**
```powershell
$userAccounts = @{
    Accounts = @(
        @{
            Username = "admin"
            Password = "Admin2024!"
            Group = "Administrators"
            Description = "システム管理者"
            PasswordNeverExpires = $true
        },
        @{
            Username = "user1"
            Password = "User2024!"
            Group = "Users"
            Description = "標準ユーザー"
            AutoLogon = $true
            AutoLogonCount = 1
        }
    )
    DisableAdministrator = $true
    DisableGuest = $true
}
```

### 9. エクスプローラー設定 (ExplorerSettings)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| ShowFileExtensions | bool | true | ファイル拡張子表示 |
| ShowHiddenFiles | bool | false | 隠しファイル表示 |
| ShowSystemFiles | bool | false | システムファイル表示 |
| ShowFullPath | bool | true | フルパス表示 |
| ShowCompressedFilesColor | bool | true | 圧縮ファイル色分け |
| LaunchSeparateProcess | bool | false | 別プロセスで起動 |
| RestorePreviousFolders | bool | true | 前回のフォルダー復元 |

### 10. スタートメニュー/タスクバー (StartMenuTaskbar)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| TaskbarAlignment | string | "Left" | タスクバー配置 |
| DisableNewsAndInterests | bool | true | ニュース無効化 |
| DisableWidgets | bool | true | ウィジェット無効化 |
| ShowTaskViewButton | bool | false | タスクビューボタン |
| ShowSearchButton | bool | true | 検索ボタン |
| DisableCortana | bool | true | Cortana無効化 |
| StartMenuLayout | string | "Default" | スタートメニューレイアウト |

### 11. システム調整 (SystemTweaks)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| DisableTelemetry | bool | true | テレメトリ無効化 |
| DisableAdvertisingID | bool | true | 広告ID無効化 |
| DisableLocationTracking | bool | true | 位置追跡無効化 |
| DisableWebSearch | bool | true | Web検索無効化 |
| DisableFeedback | bool | true | フィードバック無効化 |
| SetPrivacyLevel | string | "High" | プライバシーレベル |

### 12. 視覚効果 (VisualEffects)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| PerformanceMode | string | "Balanced" | パフォーマンスモード |
| DisableAnimations | bool | false | アニメーション無効化 |
| DisableTransparency | bool | false | 透明効果無効化 |
| DisableShadows | bool | false | 影効果無効化 |
| DisablePeek | bool | false | プレビュー無効化 |
| EnableSmoothFonts | bool | true | フォントスムージング |

**PerformanceMode値:**
- `BestAppearance`: 最高の外観
- `BestPerformance`: 最高のパフォーマンス
- `Balanced`: バランス
- `Custom`: カスタム

### 13. デスクトップアイコン (DesktopIcons)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| ShowThisPC | bool | true | このPC表示 |
| ShowUserFolder | bool | true | ユーザーフォルダー表示 |
| ShowNetwork | bool | false | ネットワーク表示 |
| ShowRecycleBin | bool | true | ごみ箱表示 |
| ShowControlPanel | bool | false | コントロールパネル表示 |
| IconSize | string | "Medium" | アイコンサイズ |

### 14. 仮想マシンサポート (VMSupport)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| EnableHyperV | bool | false | Hyper-V有効化 |
| EnableWSL | bool | false | WSL有効化 |
| EnableWSL2 | bool | false | WSL2有効化 |
| EnableVirtualMachinePlatform | bool | false | 仮想マシンプラットフォーム |
| EnableWindowsSandbox | bool | false | Windows Sandbox |
| EnableContainers | bool | false | コンテナー機能 |

### 15. Wi-Fi設定 (WiFiConfig)

| プロパティ | 型 | 必須 | デフォルト | 説明 |
|-----------|-----|------|------------|------|
| SSID | string | Yes | "20mirai18" | ネットワーク名 |
| Password | string | Yes | "20m!ra!18" | パスワード |
| SecurityType | string | Yes | "WPA2Personal" | セキュリティタイプ |
| AutoConnect | bool | No | true | 自動接続 |
| ConnectEvenIfNotBroadcasting | bool | No | false | 非公開ネットワーク接続 |
| Priority | int | No | 1 | 優先順位 |

**セキュリティタイプ:**
- `Open`: オープンネットワーク
- `WEP`: WEP暗号化
- `WPA2Personal`: WPA2-PSK
- `WPA3Personal`: WPA3-PSK
- `WPA2Enterprise`: WPA2-Enterprise

### 16. Express Settings

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| EnableOneDrive | bool | false | OneDrive有効化 |
| ProtectPC | string | "DisableProtection" | PC保護設定 |
| SendInfo | string | "DoNotSend" | 情報送信設定 |
| GetUpdates | string | "DisableAutomaticUpdates" | 更新設定 |
| ImproveInking | bool | false | 手書き入力改善 |
| TailoredExperiences | bool | false | カスタマイズ体験 |

### 17. ロックキー設定 (LockKeys)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| DisableCapsLock | bool | false | CapsLock無効化 |
| DisableNumLock | bool | false | NumLock無効化 |
| DisableScrollLock | bool | true | ScrollLock無効化 |
| RemapCapsLockToCtrl | bool | false | CapsLockをCtrlに変更 |

### 18. 固定キー設定 (StickyKeys)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| Disable | bool | true | 固定キー無効化 |
| DisableHotkey | bool | true | ホットキー無効化 |
| AudibleFeedback | bool | false | 音声フィードバック |
| TriState | bool | false | 3段階切替 |
| TwoKeysOff | bool | true | 2キーで解除 |

### 19. 個人用設定 (Personalization)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| AccentColor | string | "0x00d7c378" | アクセントカラー |
| EnableDarkMode | bool | false | ダークモード有効化 |
| BackgroundImage | string | - | 背景画像パス |
| BackgroundFit | string | "Fill" | 背景画像配置 |
| LockScreenImage | string | - | ロック画面画像 |
| UserAccountPicture | string | - | ユーザー画像 |
| ShowAccentOnTaskbar | bool | true | タスクバーアクセント色 |
| TransparencyEffects | bool | true | 透明効果 |

### 20. アプリの削除 (RemoveApps)

**削除可能なアプリ一覧:**
```powershell
$removeApps = @{
    Apps = @(
        "Microsoft.BingNews",           # ニュース
        "Microsoft.BingWeather",        # 天気
        "Microsoft.GetHelp",            # ヘルプ
        "Microsoft.Getstarted",         # ヒント
        "Microsoft.Microsoft3DViewer",   # 3Dビューアー
        "Microsoft.MicrosoftSolitaireCollection", # ソリティア
        "Microsoft.MixedReality.Portal", # Mixed Reality
        "Microsoft.Office.OneNote",     # OneNote
        "Microsoft.People",             # People
        "Microsoft.SkypeApp",           # Skype
        "Microsoft.Wallet",             # ウォレット
        "Microsoft.WindowsAlarms",      # アラーム
        "Microsoft.WindowsMaps",        # マップ
        "Microsoft.Xbox.TCUI",          # Xbox TCUI
        "Microsoft.XboxApp",            # Xbox
        "Microsoft.XboxGameOverlay",    # Xboxゲームオーバーレイ
        "Microsoft.XboxGamingOverlay",  # Xboxゲーミングオーバーレイ
        "Microsoft.XboxIdentityProvider", # Xbox ID
        "Microsoft.XboxSpeechToTextOverlay", # Xbox音声
        "Microsoft.YourPhone",          # スマホ同期
        "Microsoft.ZuneMusic",          # Groove ミュージック
        "Microsoft.ZuneVideo"           # 映画 & テレビ
    )
    RemoveProvisionedApps = $true      # プロビジョニングアプリも削除
    RemoveWindowsStore = $false        # Microsoft Store削除
}
```

### 21. カスタムスクリプト (CustomScripts)

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| PowerShellScripts | array | PowerShellスクリプトパス |
| BatchScripts | array | バッチファイルパス |
| RegistryFiles | array | レジストリファイルパス |
| ExecutionOrder | string | 実行順序 |
| RunAsAdmin | bool | 管理者権限実行 |

**実行例:**
```powershell
$customScripts = @{
    PowerShellScripts = @(
        @{
            Path = "C:\Scripts\Setup.ps1"
            Parameters = "-Mode Install"
            RunAsAdmin = $true
            Order = 1
        },
        @{
            Path = "C:\Scripts\Configure.ps1"
            Parameters = ""
            RunAsAdmin = $false
            Order = 2
        }
    )
    BatchScripts = @(
        @{
            Path = "C:\Scripts\network.bat"
            Order = 3
        }
    )
}
```

### 22. Windows Defender Application Control (WDAC)

| プロパティ | 型 | デフォルト | 説明 |
|-----------|-----|------------|------|
| EnableWDAC | bool | false | WDAC有効化 |
| PolicyMode | string | "Audit" | ポリシーモード |
| PolicyFile | string | - | ポリシーファイルパス |
| EnableSmartAppControl | bool | false | スマートアプリ制御 |
| BlockUnsignedDrivers | bool | true | 未署名ドライバーブロック |

### 23. 追加コンポーネント (AdditionalComponents)

| コンポーネント | 型 | デフォルト | 説明 |
|---------------|-----|------------|------|
| OpenSSHClient | bool | false | OpenSSHクライアント |
| OpenSSHServer | bool | false | OpenSSHサーバー |
| TelnetClient | bool | false | Telnetクライアント |
| TFTPClient | bool | false | TFTPクライアント |
| WindowsMediaPlayer | bool | true | Windows Media Player |
| InternetExplorer11 | bool | false | Internet Explorer 11 |
| PowerShellISE | bool | false | PowerShell ISE |
| WindowsFax | bool | false | Windows FAX |
| XPSViewer | bool | false | XPSビューアー |
| WorkFolders | bool | false | ワークフォルダー |

---

## プリセット設定詳細

### Enterpriseプリセット
```powershell
@{
    Name = "Enterprise"
    Description = "企業環境向け設定"
    
    # セキュリティ設定
    Security = @{
        DisableAdministrator = $true
        RequireComplexPassword = $true
        MinPasswordLength = 12
        EnableBitLocker = $true
        EnableWindowsDefender = $true
        EnableFirewall = $true
    }
    
    # ネットワーク設定
    Network = @{
        JoinDomain = $true
        EnableRemoteDesktop = $true
        DisableHomeGroup = $true
        ConfigureNLA = $true
    }
    
    # アプリケーション設定
    Applications = @{
        InstallOffice = $true
        ConfigureOutlook = $true
        SetDefaultApps = $true
        RemoveConsumerApps = $true
    }
}
```

### Developmentプリセット
```powershell
@{
    Name = "Development"
    Description = "開発者環境向け設定"
    
    # 開発ツール
    DevelopmentTools = @{
        EnableWSL2 = $true
        EnableHyperV = $true
        EnableContainers = $true
        EnableSandbox = $true
        InstallOpenSSH = $true
        EnableDeveloperMode = $true
    }
    
    # パフォーマンス設定
    Performance = @{
        DisableVisualEffects = $true
        SetHighPerformance = $true
        DisableSearchIndexing = $false
        EnableFastStartup = $false
    }
}
```

### Minimalプリセット
```powershell
@{
    Name = "Minimal"
    Description = "最小構成"
    
    # 最小化設定
    Minimization = @{
        RemoveAllApps = $true
        DisableAllTelemetry = $true
        DisableAllServices = $true
        MinimalVisualEffects = $true
    }
    
    # リソース最適化
    ResourceOptimization = @{
        DisableBackgroundApps = $true
        DisableNotifications = $true
        DisableAnimations = $true
        ReduceMemoryUsage = $true
    }
}
```

---

## Context7コンテキスト設定

### コンテキスト一覧
| コンテキスト | 用途 | 優先設定 |
|-------------|------|----------|
| Enterprise | 企業環境 | セキュリティ、管理性 |
| Development | 開発環境 | 開発ツール、柔軟性 |
| Education | 教育機関 | 制限、監視 |
| HomeUse | 個人利用 | 使いやすさ、エンターテイメント |
| Security | セキュリティ重視 | 最大セキュリティ |
| Performance | パフォーマンス重視 | 速度、効率 |
| Minimal | 最小構成 | 軽量、シンプル |

### コンテキスト自動検出
```powershell
# Context7による自動検出
$detectedContext = Get-Context7Detection

# 結果例
@{
    PrimaryContext = "Enterprise"
    SecondaryContext = "Security"
    Confidence = 0.85
    Reasons = @(
        "Domain joined detected",
        "Multiple admin accounts",
        "Enterprise features enabled"
    )
}
```

### コンテキスト競合解決
```powershell
# 競合する設定の自動解決
$config = @{
    EnableTelemetry = $true    # Developmentコンテキスト
    DisableTelemetry = $true   # Securityコンテキスト
}

$resolved = Resolve-Context7Conflict -Config $config -Priority "Security"
# 結果: DisableTelemetry = $true (Securityが優先)
```

---

## 詳細設定オプション

### パフォーマンスチューニング
```powershell
$performanceConfig = @{
    # スレッド設定
    Threading = @{
        MaxThreads = [Environment]::ProcessorCount
        MinThreads = 2
        ThreadPriority = "Normal"
    }
    
    # メモリ設定
    Memory = @{
        MaxMemoryMB = 1024
        EnableCaching = $true
        CacheExpirationMinutes = 30
    }
    
    # I/O設定
    IO = @{
        BufferSize = 65536
        AsyncIO = $true
        CompressOutput = $false
    }
}
```

### ログ設定
```powershell
$loggingConfig = @{
    # ログレベル
    LogLevel = "Info"  # Debug, Info, Warning, Error, Critical
    
    # ログ出力先
    Outputs = @{
        File = $true
        Console = $true
        EventLog = $false
    }
    
    # ログフォーマット
    Format = @{
        IncludeTimestamp = $true
        IncludeCallStack = $false
        IncludeMachineName = $true
    }
    
    # ログローテーション
    Rotation = @{
        MaxSizeMB = 100
        MaxFiles = 10
        CompressOldLogs = $true
    }
}
```

### エラーハンドリング
```powershell
$errorConfig = @{
    # エラー処理
    ErrorHandling = @{
        StopOnError = $false
        RetryCount = 3
        RetryDelaySeconds = 5
        LogErrors = $true
    }
    
    # 検証設定
    Validation = @{
        ValidateSchema = $true
        ValidateValues = $true
        StrictMode = $false
    }
    
    # リカバリー設定
    Recovery = @{
        CreateBackup = $true
        AutoRecover = $true
        RecoveryPath = ".\Recovery"
    }
}
```

---

## 設定の検証ルール

### 必須フィールド検証
```powershell
$requiredFields = @{
    "RegionalSettings" = @("InputLocale", "SystemLocale", "UILanguage")
    "ComputerSettings" = @("ComputerName", "TimeZone")
    "UserAccounts" = @("Username", "Password", "Group")
}
```

### 値の妥当性検証
```powershell
$validationRules = @{
    ComputerName = @{
        Pattern = "^[a-zA-Z0-9\-]{1,15}$"
        Message = "コンピューター名は1-15文字の英数字とハイフンのみ"
    }
    Password = @{
        MinLength = 8
        RequireComplexity = $true
        Message = "パスワードは8文字以上で大小英字、数字、特殊文字を含む"
    }
    TimeZone = @{
        ValidValues = @("Tokyo Standard Time", "Pacific Standard Time", "Eastern Standard Time")
        Message = "有効なタイムゾーンを指定してください"
    }
}
```

### 依存関係検証
```powershell
$dependencies = @{
    "EnableHyperV" = @{
        Requires = @("ProcessorArchitecture=amd64", "EnableVirtualization=true")
        Conflicts = @("EnableVMware=true")
    }
    "JoinDomain" = @{
        Requires = @("Domain", "DomainAdmin", "DomainPassword")
        Conflicts = @("WorkgroupMode=true")
    }
}
```

---

## 設定のエクスポート/インポート

### エクスポート
```powershell
# 現在の設定をエクスポート
Export-UnattendConfig -Path ".\config-backup.json" -Format JSON

# 暗号化してエクスポート
Export-UnattendConfig -Path ".\config-secure.json" -Encrypt -Password (Read-Host -AsSecureString)
```

### インポート
```powershell
# 設定をインポート
$config = Import-UnattendConfig -Path ".\config-backup.json"

# 暗号化された設定をインポート
$config = Import-UnattendConfig -Path ".\config-secure.json" -Password (Read-Host -AsSecureString)
```

---

## 次のステップ

1. **[SubAgentリファレンス.md](./SubAgentリファレンス.md)** - 42体のSubAgentの詳細
2. **[トラブルシューティングガイド_v2.md](./トラブルシューティングガイド_v2.md)** - 問題解決ガイド
3. **[開発完了報告書.md](./開発完了報告書.md)** - v2.0開発完了報告

---

*最終更新: 2024年8月24日 | バージョン: 2.0.0*