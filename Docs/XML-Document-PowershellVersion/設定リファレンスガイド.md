# Windows 11 Sysprep応答ファイル自動生成システム（PowerShell版）
## 設定リファレンスガイド

### 目次
1. [設定ファイルの構造](#設定ファイルの構造)
2. [システム設定項目](#システム設定項目)
3. [ユーザーアカウント設定](#ユーザーアカウント設定)
4. [アプリケーション設定](#アプリケーション設定)
5. [ネットワーク設定](#ネットワーク設定)
6. [Windows機能設定](#Windows機能設定)
7. [セキュリティ設定](#セキュリティ設定)
8. [地域・言語設定](#地域・言語設定)
9. [管理・運用設定](#管理・運用設定)
10. [カスタム設定](#カスタム設定)
11. [設定値リファレンス表](#設定値リファレンス表)
12. [設定のカスタマイズ方法](#設定のカスタマイズ方法)

---

## 設定ファイルの構造

### 基本形式

設定ファイルはPowerShellデータファイル（.psd1）またはJSON形式で記述します。

#### PSD1形式の基本構造
```powershell
@{
    # システム基本設定
    System = @{ ... }
    
    # ユーザーアカウント設定
    Users = @( ... )
    
    # アプリケーション設定
    Applications = @{ ... }
    
    # ネットワーク設定
    Network = @{ ... }
    
    # Windows機能設定
    WindowsFeatures = @{ ... }
    
    # セキュリティ設定
    Security = @{ ... }
    
    # 地域・言語設定
    Regional = @{ ... }
    
    # 管理設定
    Management = @{ ... }
    
    # カスタム設定
    CustomSettings = @{ ... }
}
```

#### JSON形式の基本構造
```json
{
  "System": { ... },
  "Users": [ ... ],
  "Applications": { ... },
  "Network": { ... },
  "WindowsFeatures": { ... },
  "Security": { ... },
  "Regional": { ... },
  "Management": { ... },
  "CustomSettings": { ... }
}
```

### 設定セクション一覧

| セクション | 必須 | 説明 |
|-----------|------|------|
| `System` | ○ | ホスト名、タイムゾーンなど基本システム設定 |
| `Users` | ○ | ユーザーアカウントの作成・管理設定 |
| `Applications` | × | アプリケーションの初期設定とデフォルト関連付け |
| `Network` | × | ネットワーク関連の設定 |
| `WindowsFeatures` | × | Windows機能の有効化・無効化 |
| `Security` | × | セキュリティポリシーと設定 |
| `Regional` | × | 地域・言語・タイムゾーン設定 |
| `Management` | × | 管理・運用に関する設定 |
| `CustomSettings` | × | プリセット固有のメタデータ |

---

## システム設定項目

### System セクション

基本的なシステム設定を定義します。

#### 設定項目

| 項目 | 型 | 必須 | デフォルト | 説明 | 値の例 |
|-----|----|----|----------|------|--------|
| `HostName` | string | ○ | "WIN11-PC" | コンピューター名 | "WIN11-ENT-001" |
| `TimeZone` | string | × | "Tokyo Standard Time" | タイムゾーン | "Tokyo Standard Time" |
| `DisableIPv6` | bool | × | true | IPv6プロトコルの無効化 | true / false |
| `DisableFirewall` | bool | × | true | Windows Firewallの無効化 | true / false |
| `DisableBluetooth` | bool | × | true | Bluetoothの無効化 | true / false |
| `MuteAudio` | bool | × | true | 音声出力のミュート | true / false |

#### 設定例

```powershell
System = @{
    HostName = "WIN11-ENTERPRISE-001"
    TimeZone = "Tokyo Standard Time"
    DisableIPv6 = $true
    DisableFirewall = $true  # 企業ファイアウォール使用時
    DisableBluetooth = $true
    MuteAudio = $false  # エンタープライズ環境では音声有効
}
```

#### サポート対象タイムゾーン

| タイムゾーン | 標準名 | 説明 |
|-------------|--------|------|
| 東京標準時 | "Tokyo Standard Time" | 日本標準時（JST, UTC+9） |
| 協定世界時 | "UTC" | 協定世界時（UTC+0） |
| 東部標準時 | "Eastern Standard Time" | 米国東部標準時（EST, UTC-5） |
| 太平洋標準時 | "Pacific Standard Time" | 米国太平洋標準時（PST, UTC-8） |
| 中央ヨーロッパ標準時 | "Central Europe Standard Time" | 中央ヨーロッパ時間（CET, UTC+1） |

---

## ユーザーアカウント設定

### Users セクション

ローカルユーザーアカウントの作成と管理を設定します。

#### 基本構造

```powershell
Users = @(
    @{
        Name = "ユーザー名"
        Password = "パスワード"  # 通常ユーザーの場合
        IsEnabled = $true/$false  # ビルトインアカウントの場合
        Groups = @("グループ1", "グループ2")
        DisplayName = "表示名"
        Description = "説明"
        # オプション設定...
    }
)
```

#### 設定項目

| 項目 | 型 | 必須 | 説明 | 値の例 |
|-----|----|----|------|--------|
| `Name` | string | ○ | ユーザーアカウント名 | "mirai-user" |
| `Password` | string | △ | パスワード（通常ユーザー） | "SecurePass2025!" |
| `IsEnabled` | bool | △ | 有効状態（ビルトインアカウント） | true / false |
| `Groups` | string[] | × | 所属グループ | @("Administrators", "Users") |
| `DisplayName` | string | × | 表示名 | "Mirai User" |
| `Description` | string | × | アカウント説明 | "システム管理者アカウント" |
| `PasswordNeverExpires` | bool | × | パスワード無期限 | false |
| `UserMayNotChangePassword` | bool | × | パスワード変更禁止 | false |
| `PasswordHint` | string | × | パスワードヒント | "" |

#### ユーザーアカウント種別

##### 1. 通常ユーザーアカウント
新規作成するユーザーアカウントです。

```powershell
@{
    Name = "mirai-user"
    Password = "MiraiUser2025!"
    Groups = @("Administrators", "Users")
    DisplayName = "Mirai User"
    Description = "メイン管理者アカウント"
    PasswordNeverExpires = $false
    UserMayNotChangePassword = $false
}
```

##### 2. ビルトインアカウント
Windows標準のアカウント（Administrator等）の有効化・無効化を設定します。

```powershell
@{
    Name = "Administrator"
    IsEnabled = $false  # セキュリティのため無効化
}
```

#### 利用可能なグループ

| グループ名 | 説明 | 権限レベル |
|-----------|------|-----------|
| `Administrators` | 管理者グループ | 最高権限 |
| `Users` | 標準ユーザー | 通常権限 |
| `Power Users` | パワーユーザー | 中間権限（レガシー） |
| `Remote Desktop Users` | リモートデスクトップユーザー | RDP接続権限 |
| `Backup Operators` | バックアップオペレーター | バックアップ権限 |
| `Network Configuration Operators` | ネットワーク構成オペレーター | ネットワーク設定権限 |

#### パスワードポリシー

システムが生成するパスワードは以下の要件を満たす必要があります：

- **最小長**: 8文字以上
- **複雑さ**: 大文字・小文字・数字・記号の組み合わせ
- **禁止文字**: ユーザー名・表示名の包含禁止
- **一般的パスワード**: 辞書攻撃に脆弱なパスワード禁止

#### 設定例

##### Enterprise環境
```powershell
Users = @(
    @{
        Name = "Administrator"
        IsEnabled = $false
    },
    @{
        Name = "mirai-user"
        Password = "MiraiEnt2025!@#"
        Groups = @("Administrators", "Users")
        DisplayName = "Mirai Administrator"
        Description = "企業システム管理者アカウント"
        PasswordNeverExpires = $false
    },
    @{
        Name = "l-admin"
        Password = "LAdminEnt2025!@#"
        Groups = @("Administrators", "Users")
        DisplayName = "Local Administrator"
        Description = "ローカル管理者アカウント"
    },
    @{
        Name = "enterprise-user"
        Password = "EntUser2025!@#"
        Groups = @("Users", "Remote Desktop Users")
        DisplayName = "Enterprise User"
        Description = "一般企業ユーザーアカウント"
    }
)
```

##### Development環境
```powershell
Users = @(
    @{
        Name = "Administrator"
        IsEnabled = $false
    },
    @{
        Name = "dev-admin"
        Password = "DevAdmin2025!@#"
        Groups = @("Administrators", "Users")
        DisplayName = "Development Administrator"
        Description = "開発環境管理者"
    },
    @{
        Name = "developer"
        Password = "Developer2025!@#"
        Groups = @("Users", "Power Users")
        DisplayName = "Developer"
        Description = "開発者アカウント"
    }
)
```

---

## アプリケーション設定

### Applications セクション

アプリケーションの初期設定とファイル関連付けを定義します。

#### 基本構造

```powershell
Applications = @{
    EnableDotNet35 = $true/$false
    DefaultBrowser = "ブラウザー識別子"
    DefaultMailClient = "メールクライアント識別子"
    DefaultPDFReader = "PDFリーダー識別子"
    
    OfficeSettings = @{ ... }
    TaskbarSettings = @{ ... }
}
```

#### 基本設定項目

| 項目 | 型 | 必須 | デフォルト | 説明 |
|-----|----|----|----------|------|
| `EnableDotNet35` | bool | × | true | .NET Framework 3.5有効化 |
| `DefaultBrowser` | string | × | "MSEdgeHTM" | 既定のWebブラウザー |
| `DefaultMailClient` | string | × | "Outlook.File.msg.15" | 既定のメールクライアント |
| `DefaultPDFReader` | string | × | "AcroExch.Document" | 既定のPDFリーダー |

#### 対応ブラウザー識別子

| ブラウザー | 識別子 | 説明 |
|----------|-------|------|
| Microsoft Edge | `MSEdgeHTM` | Windows 11標準ブラウザー |
| Google Chrome | `ChromeHTML` | Chrome（インストール済みの場合） |
| Mozilla Firefox | `FirefoxHTML` | Firefox（インストール済みの場合） |
| Internet Explorer | `IE.HTTP` | IE（非推奨） |

#### 対応メールクライアント

| メールクライアント | 識別子 | 説明 |
|------------------|-------|------|
| Microsoft Outlook | `Outlook.File.msg.15` | Office Outlook |
| Windows Mail | `Mail` | Windows 11標準メールアプリ |
| Thunderbird | `ThunderbirdEML` | Mozilla Thunderbird |

#### 対応PDFリーダー

| PDFリーダー | 識別子 | 説明 |
|-----------|-------|------|
| Adobe Acrobat Reader DC | `AcroExch.Document` | Adobe PDF Reader |
| Microsoft Edge | `MSEdgeHTM` | Edge内蔵PDFビューアー |
| Windows Reader | `Windows.Data.Pdf.PdfDocument` | Windows標準PDFリーダー |

### Office設定

Microsoft Officeアプリケーションの初期設定を行います。

```powershell
OfficeSettings = @{
    SkipFirstRun = $true/$false
    AcceptEula = $true/$false
    DisableTelemetry = $true/$false
    DisableUpdates = $true/$false
    EnableMacros = $true/$false
}
```

| 項目 | 型 | デフォルト | 説明 |
|-----|----|---------|----- |
| `SkipFirstRun` | bool | true | 初回実行ウィザードのスキップ |
| `AcceptEula` | bool | true | 使用許諾契約の自動承諾 |
| `DisableTelemetry` | bool | true | テレメトリ送信の無効化 |
| `DisableUpdates` | bool | false | 自動更新の無効化 |
| `EnableMacros` | bool | false | マクロ実行の有効化 |

### タスクバー設定

Windowsタスクバーの表示設定を行います。

```powershell
TaskbarSettings = @{
    ShowSearchBox = 0/1/2
    ShowCortanaButton = 0/1
    ShowTaskViewButton = 0/1
    TaskbarDa = 0/1
    TaskbarSi = 0/1
    TaskbarAlignment = 0/1
}
```

| 項目 | 型 | 値 | 説明 |
|-----|----|----|------|
| `ShowSearchBox` | int | 0: 非表示<br>1: 検索アイコン<br>2: 検索ボックス | 検索機能の表示方法 |
| `ShowCortanaButton` | int | 0: 非表示<br>1: 表示 | Cortanaボタンの表示 |
| `ShowTaskViewButton` | int | 0: 非表示<br>1: 表示 | タスクビューボタンの表示 |
| `TaskbarDa` | int | 0: 無効<br>1: 有効 | ニュースと関心事項 |
| `TaskbarSi` | int | 0: 大きいボタン<br>1: 小さいボタン | タスクバーボタンのサイズ |
| `TaskbarAlignment` | int | 0: 左寄せ<br>1: 中央寄せ | タスクバーの配置 |

#### 環境別推奨設定

##### Enterprise環境
```powershell
Applications = @{
    EnableDotNet35 = $true
    DefaultBrowser = "MSEdgeHTM"
    DefaultMailClient = "Outlook.File.msg.15"
    DefaultPDFReader = "AcroExch.Document"
    
    OfficeSettings = @{
        SkipFirstRun = $true
        AcceptEula = $true
        DisableTelemetry = $true
        DisableUpdates = $false  # 企業では更新管理
        EnableMacros = $false    # セキュリティ重視
    }
    
    TaskbarSettings = @{
        ShowSearchBox = 1        # 検索アイコンのみ
        ShowCortanaButton = 0    # Cortana無効
        ShowTaskViewButton = 1   # タスクビュー有効
        TaskbarDa = 0           # ニュース無効
        TaskbarSi = 0           # 大きいボタン
        TaskbarAlignment = 0     # 左寄せ
    }
}
```

##### Development環境
```powershell
Applications = @{
    EnableDotNet35 = $true
    DefaultBrowser = "ChromeHTML"  # 開発者向け
    DefaultMailClient = "Outlook.File.msg.15"
    DefaultPDFReader = "MSEdgeHTM"  # 軽量
    
    OfficeSettings = @{
        SkipFirstRun = $true
        AcceptEula = $true
        DisableTelemetry = $false   # 問題レポート有効
        DisableUpdates = $false
        EnableMacros = $true        # 開発・テスト用
    }
    
    TaskbarSettings = @{
        ShowSearchBox = 2          # 検索ボックス表示
        ShowCortanaButton = 0
        ShowTaskViewButton = 1
        TaskbarDa = 0
        TaskbarSi = 1             # 小さいボタン（多くのアプリ表示）
        TaskbarAlignment = 0
    }
}
```

##### Minimal環境
```powershell
Applications = @{
    EnableDotNet35 = $false    # 軽量化
    DefaultBrowser = "MSEdgeHTM"
    DefaultMailClient = "Mail"  # 標準アプリ
    DefaultPDFReader = "MSEdgeHTM"
    
    OfficeSettings = @{
        SkipFirstRun = $true
        AcceptEula = $true
        DisableTelemetry = $true
        DisableUpdates = $true   # 軽量化重視
        EnableMacros = $false
    }
    
    TaskbarSettings = @{
        ShowSearchBox = 0        # すべて非表示
        ShowCortanaButton = 0
        ShowTaskViewButton = 0
        TaskbarDa = 0
        TaskbarSi = 1           # 小さいボタン
        TaskbarAlignment = 0
    }
}
```

---

## ネットワーク設定

### Network セクション

ネットワーク関連の設定を定義します。

#### 基本設定項目

```powershell
Network = @{
    DisableIPv6 = $true/$false
    DisableFirewall = $true/$false
    DisableBluetooth = $true/$false
    DefaultNetworkProfile = "Private"/"Public"
    
    GroupPolicySettings = @{ ... }
}
```

| 項目 | 型 | デフォルト | 説明 |
|-----|----|---------|----- |
| `DisableIPv6` | bool | true | IPv6プロトコルの無効化 |
| `DisableFirewall` | bool | true | Windows Defenderファイアウォールの無効化 |
| `DisableBluetooth` | bool | true | Bluetoothサービスの無効化 |
| `DefaultNetworkProfile` | string | "Private" | 既定のネットワークプロファイル |

#### ネットワークプロファイル

| プロファイル | 説明 | セキュリティレベル | 使用場面 |
|-------------|------|------------------|-----------|
| `Private` | プライベートネットワーク | 中程度 | 社内LAN、家庭内ネットワーク |
| `Public` | パブリックネットワーク | 高 | 公衆Wi-Fi、信頼できないネットワーク |

### グループポリシー設定

ネットワーク関連のグループポリシー設定を行います。

```powershell
GroupPolicySettings = @{
    EnableInsecureGuestLogons = $true/$false
    EnableNetworkDiscovery = $true/$false
    DisableSMBSigning = $true/$false
}
```

| 項目 | 型 | 説明 | セキュリティ影響 |
|-----|----|----- |----------------|
| `EnableInsecureGuestLogons` | bool | 安全でないゲストログオンの有効化 | ファイル共有利便性向上、セキュリティリスク |
| `EnableNetworkDiscovery` | bool | ネットワーク探索の有効化 | ネットワーク利便性向上、プライバシーリスク |
| `DisableSMBSigning` | bool | SMB署名の無効化 | パフォーマンス向上、セキュリティリスク |

#### 環境別推奨設定

##### Enterprise環境（セキュリティ重視）
```powershell
Network = @{
    DisableIPv6 = $true
    DisableFirewall = $true      # 企業ファイアウォール使用
    DisableBluetooth = $true
    DefaultNetworkProfile = "Private"
    
    GroupPolicySettings = @{
        EnableInsecureGuestLogons = $true   # ファイル共有のため
        EnableNetworkDiscovery = $true
        DisableSMBSigning = $false          # セキュリティ重視
    }
}
```

##### Development環境（利便性重視）
```powershell
Network = @{
    DisableIPv6 = $false         # 最新技術テスト
    DisableFirewall = $true      # 開発利便性
    DisableBluetooth = $false    # IoT開発
    DefaultNetworkProfile = "Private"
    
    GroupPolicySettings = @{
        EnableInsecureGuestLogons = $true
        EnableNetworkDiscovery = $true
        DisableSMBSigning = $true           # パフォーマンス重視
    }
}
```

##### Minimal環境（最小構成）
```powershell
Network = @{
    DisableIPv6 = $true          # 軽量化
    DisableFirewall = $false     # 基本セキュリティ
    DisableBluetooth = $true     # リソース節約
    DefaultNetworkProfile = "Public"  # より安全
    
    GroupPolicySettings = @{
        EnableInsecureGuestLogons = $false  # セキュリティ重視
        EnableNetworkDiscovery = $false     # プライバシー重視
        DisableSMBSigning = $false          # セキュリティ保持
    }
}
```

---

## Windows機能設定

### WindowsFeatures セクション

Windows機能の有効化・無効化を設定します。

#### 基本構造

```powershell
WindowsFeatures = @{
    EnableDotNet35 = $true/$false
    EnableHyperV = $true/$false
    EnableWSL = $true/$false
    EnableWindowsSandbox = $true/$false
    DisableCortana = $true/$false
    DisableWindowsSearch = $true/$false
    
    OptionalFeatures = @{ ... }
    Capabilities = @{ ... }
}
```

#### 主要機能設定

| 項目 | 型 | デフォルト | 説明 | 用途 |
|-----|----|---------|----- |------|
| `EnableDotNet35` | bool | true | .NET Framework 3.5有効化 | レガシーアプリ対応 |
| `EnableHyperV` | bool | false | Hyper-V有効化 | 仮想マシン、Docker |
| `EnableWSL` | bool | false | Windows Subsystem for Linux | Linux開発環境 |
| `EnableWindowsSandbox` | bool | false | Windows Sandbox有効化 | セキュアテスト環境 |
| `DisableCortana` | bool | true | Cortana無効化 | プライバシー、リソース節約 |
| `DisableWindowsSearch` | bool | false | Windows Search無効化 | 軽量化（検索機能なし） |

### オプション機能設定

Windowsオプション機能の有効化・無効化を設定します。

```powershell
OptionalFeatures = @{
    TelnetClient = "Enabled"/"Disabled"
    TFTP = "Enabled"/"Disabled"
    SimpleTCP = "Enabled"/"Disabled"
    WorkFoldersClient = "Enabled"/"Disabled"
}
```

| 機能 | 説明 | Enterprise | Development | Minimal |
|------|------|-----------|-------------|---------|
| `TelnetClient` | Telnetクライアント | Disabled | Enabled | Disabled |
| `TFTP` | TFTPクライアント | Disabled | Enabled | Disabled |
| `SimpleTCP` | Simple TCP/IPサービス | Disabled | Enabled | Disabled |
| `WorkFoldersClient` | Work Foldersクライアント | Enabled | Disabled | Disabled |

### Windows Capability設定

Windows Capabilityの管理を行います。

```powershell
Capabilities = @{
    "OpenSSH.Client" = "Enabled"/"Disabled"
    "OpenSSH.Server" = "Enabled"/"Disabled"
    "PowerShell.ISE" = "Enabled"/"Disabled"
}
```

| Capability | 説明 | Enterprise | Development | Minimal |
|------------|------|-----------|-------------|---------|
| `OpenSSH.Client` | SSHクライアント | Enabled | Enabled | Disabled |
| `OpenSSH.Server` | SSHサーバー | Disabled | Enabled | Disabled |
| `PowerShell.ISE` | PowerShell ISE | Enabled | Enabled | Disabled |

#### 環境別推奨設定

##### Enterprise環境
```powershell
WindowsFeatures = @{
    EnableDotNet35 = $true          # レガシーアプリ対応
    EnableHyperV = $false           # 一般企業では無効
    EnableWSL = $false              # 開発用途でなければ無効
    EnableWindowsSandbox = $false
    DisableCortana = $true          # プライバシー重視
    DisableWindowsSearch = $false   # 検索機能は有用
    
    OptionalFeatures = @{
        TelnetClient = "Disabled"
        TFTP = "Disabled"
        SimpleTCP = "Disabled"
        WorkFoldersClient = "Enabled"  # 企業ファイル同期
    }
    
    Capabilities = @{
        "OpenSSH.Client" = "Enabled"   # リモート管理
        "OpenSSH.Server" = "Disabled"  # セキュリティリスク
        "PowerShell.ISE" = "Enabled"   # 管理者用
    }
}
```

##### Development環境
```powershell
WindowsFeatures = @{
    EnableDotNet35 = $true          # 開発環境では必須
    EnableHyperV = $true            # 仮想環境テスト
    EnableWSL = $true               # Linux開発
    EnableWindowsSandbox = $true    # セキュリティテスト
    DisableCortana = $false         # 検索で有用
    DisableWindowsSearch = $false
    
    OptionalFeatures = @{
        TelnetClient = "Enabled"      # ネットワークテスト
        TFTP = "Enabled"              # ファームウェア開発
        SimpleTCP = "Enabled"         # プロトコルテスト
        WorkFoldersClient = "Disabled"
    }
    
    Capabilities = @{
        "OpenSSH.Client" = "Enabled"
        "OpenSSH.Server" = "Enabled"  # リモート開発
        "PowerShell.ISE" = "Enabled"
    }
}
```

##### Minimal環境
```powershell
WindowsFeatures = @{
    EnableDotNet35 = $false         # 軽量化重視
    EnableHyperV = $false
    EnableWSL = $false
    EnableWindowsSandbox = $false
    DisableCortana = $true          # リソース節約
    DisableWindowsSearch = $true    # 軽量化重視
    
    OptionalFeatures = @{
        TelnetClient = "Disabled"
        TFTP = "Disabled"
        SimpleTCP = "Disabled"
        WorkFoldersClient = "Disabled"
    }
    
    Capabilities = @{
        "OpenSSH.Client" = "Disabled"
        "OpenSSH.Server" = "Disabled"
        "PowerShell.ISE" = "Disabled"  # コンソールのみ
    }
}
```

---

## セキュリティ設定

### Security セクション

Windowsセキュリティ関連の設定を定義します。

#### 基本構造

```powershell
Security = @{
    DisableUAC = $true/$false
    EnableWindowsDefender = $true/$false
    ConfigureWindowsUpdate = @{ ... }
    PrivacySettings = @{ ... }
    DeveloperMode = @{ ... }  # 開発環境のみ
}
```

#### 基本セキュリティ設定

| 項目 | 型 | デフォルト | 説明 | セキュリティ影響 |
|-----|----|---------|----- |----------------|
| `DisableUAC` | bool | false | ユーザーアカウント制御(UAC)無効化 | セキュリティリスク大 |
| `EnableWindowsDefender` | bool | true | Windows Defenderの有効化 | マルウェア対策必須 |

### Windows Update設定

自動更新の動作を制御します。

```powershell
ConfigureWindowsUpdate = @{
    AutoUpdate = $true/$false
    RestartRequired = $true/$false
    DeferFeatureUpdates = 0-365    # 日数
    DeferQualityUpdates = 0-30     # 日数
}
```

| 項目 | 型 | 説明 | 推奨値 |
|-----|----|----- |--------|
| `AutoUpdate` | bool | 自動更新の有効化 | true（セキュリティ重要） |
| `RestartRequired` | bool | 更新後の自動再起動 | false（業務継続性） |
| `DeferFeatureUpdates` | int | 機能更新の延期日数（0-365） | 180（安定性確保） |
| `DeferQualityUpdates` | int | 品質更新の延期日数（0-30） | 7（セキュリティと安定性バランス） |

### プライバシー設定

個人情報の収集・送信を制御します。

```powershell
PrivacySettings = @{
    DisableTelemetry = $true/$false
    DisableAdvertisingID = $true/$false
    DisableLocationServices = $true/$false
    DisableCameraAccess = $true/$false
    DisableMicrophoneAccess = $true/$false
}
```

| 項目 | 型 | 説明 | プライバシー影響 |
|-----|----|----- |-----------------|
| `DisableTelemetry` | bool | テレメトリ送信の無効化 | 個人データ保護 |
| `DisableAdvertisingID` | bool | 広告IDの無効化 | 追跡防止 |
| `DisableLocationServices` | bool | 位置情報サービス無効化 | 位置情報保護 |
| `DisableCameraAccess` | bool | カメラアクセス制限 | プライバシー保護 |
| `DisableMicrophoneAccess` | bool | マイクアクセス制限 | プライバシー保護 |

### 開発者モード設定（Development環境のみ）

```powershell
DeveloperMode = @{
    EnableDeveloperMode = $true/$false
    EnableSideloading = $true/$false
    EnableDevicePortal = $true/$false
}
```

| 項目 | 説明 | 用途 |
|-----|------|------|
| `EnableDeveloperMode` | 開発者モードの有効化 | UWPアプリ開発 |
| `EnableSideloading` | サイドローディング有効化 | 非ストアアプリインストール |
| `EnableDevicePortal` | デバイスポータル有効化 | リモートデバッグ |

#### 環境別推奨設定

##### Enterprise環境（高セキュリティ）
```powershell
Security = @{
    DisableUAC = $false           # UAC有効（重要）
    EnableWindowsDefender = $true
    
    ConfigureWindowsUpdate = @{
        AutoUpdate = $true
        RestartRequired = $false
        DeferFeatureUpdates = 180  # 半年延期（安定性重視）
        DeferQualityUpdates = 30   # 1ヶ月延期（検証時間確保）
    }
    
    PrivacySettings = @{
        DisableTelemetry = $true
        DisableAdvertisingID = $true
        DisableLocationServices = $true
        DisableCameraAccess = $false     # Web会議で使用
        DisableMicrophoneAccess = $false
    }
}
```

##### Development環境（利便性重視）
```powershell
Security = @{
    DisableUAC = $false           # 開発でも基本セキュリティ保持
    EnableWindowsDefender = $true
    
    ConfigureWindowsUpdate = @{
        AutoUpdate = $false       # 開発作業中断回避
        RestartRequired = $false
        DeferFeatureUpdates = 365 # 1年延期（開発環境安定化）
        DeferQualityUpdates = 90  # 3ヶ月延期
    }
    
    PrivacySettings = @{
        DisableTelemetry = $false # 問題レポート有効
        DisableAdvertisingID = $true
        DisableLocationServices = $false # 位置ベースアプリ開発
        DisableCameraAccess = $false
        DisableMicrophoneAccess = $false
    }
    
    # 開発者モード設定
    DeveloperMode = @{
        EnableDeveloperMode = $true
        EnableSideloading = $true
        EnableDevicePortal = $true
    }
}
```

##### Minimal環境（プライバシー重視）
```powershell
Security = @{
    DisableUAC = $false
    EnableWindowsDefender = $true
    
    ConfigureWindowsUpdate = @{
        AutoUpdate = $true
        RestartRequired = $false
        DeferFeatureUpdates = 365
        DeferQualityUpdates = 7    # セキュリティ更新は早期適用
    }
    
    PrivacySettings = @{
        DisableTelemetry = $true   # 完全なプライバシー保護
        DisableAdvertisingID = $true
        DisableLocationServices = $true
        DisableCameraAccess = $true
        DisableMicrophoneAccess = $true
    }
}
```

---

## 地域・言語設定

### Regional セクション

地域、言語、タイムゾーンの設定を定義します。

#### 基本設定項目

```powershell
Regional = @{
    InputLocale = "ja-JP"
    SystemLocale = "ja-JP"
    UILanguage = "ja-JP"
    UserLocale = "ja-JP"
    TimeZone = "Tokyo Standard Time"
    GeoID = 122
}
```

| 項目 | 型 | 説明 | 例 |
|-----|----|----- |----|
| `InputLocale` | string | 入力ロケール（キーボード配列） | "ja-JP", "en-US" |
| `SystemLocale` | string | システムロケール（非Unicodeアプリ用） | "ja-JP", "en-US" |
| `UILanguage` | string | ユーザーインターフェース言語 | "ja-JP", "en-US" |
| `UserLocale` | string | ユーザーロケール（日付・通貨形式） | "ja-JP", "en-US" |
| `TimeZone` | string | タイムゾーン | "Tokyo Standard Time" |
| `GeoID` | int | 地理的位置ID | 122（日本）, 244（米国） |

#### サポート対象ロケール

| 言語・地域 | ロケールコード | GeoID | タイムゾーン |
|-----------|--------------|-------|-------------|
| 日本 | ja-JP | 122 | Tokyo Standard Time |
| 米国（英語） | en-US | 244 | Eastern Standard Time |
| 英国（英語） | en-GB | 242 | GMT Standard Time |
| ドイツ | de-DE | 94 | W. Europe Standard Time |
| フランス | fr-FR | 84 | Romance Standard Time |
| 韓国 | ko-KR | 134 | Korea Standard Time |
| 中国（簡体字） | zh-CN | 45 | China Standard Time |

#### 地理的位置ID（主要国）

| 国・地域 | GeoID |
|---------|--------|
| 日本 | 122 |
| アメリカ合衆国 | 244 |
| カナダ | 39 |
| イギリス | 242 |
| ドイツ | 94 |
| フランス | 84 |
| 韓国 | 134 |
| 中国 | 45 |
| オーストラリア | 12 |
| インド | 113 |

---

## 管理・運用設定

### Management セクション

システム管理と運用に関する設定を定義します。

#### 基本構造

```powershell
Management = @{
    EnableRemoteDesktop = $true/$false
    ConfigureEventLogs = @{ ... }
    PerformanceSettings = @{ ... }
    DomainSettings = @{ ... }
}
```

### リモートデスクトップ設定

| 項目 | 型 | デフォルト | 説明 |
|-----|----|---------|----- |
| `EnableRemoteDesktop` | bool | false | リモートデスクトップの有効化 |

### イベントログ設定

```powershell
ConfigureEventLogs = @{
    MaxLogSize = 104857600      # バイト単位
    RetentionDays = 90
}
```

| 項目 | 型 | 説明 | 推奨値 |
|-----|----|----- |--------|
| `MaxLogSize` | int | 最大ログサイズ（バイト） | 104857600（100MB） |
| `RetentionDays` | int | ログ保持日数 | 90（3ヶ月） |

#### ログサイズ推奨値

| 環境 | サイズ（MB） | バイト値 | 用途 |
|------|-----------|---------|------|
| Enterprise | 100 | 104857600 | 詳細な監査ログ |
| Development | 50 | 52428800 | 開発・デバッグ用 |
| Minimal | 20 | 20971520 | 最小限のログ |

### パフォーマンス設定

```powershell
PerformanceSettings = @{
    VisualEffects = "Performance"/"Appearance"/"Custom"
    VirtualMemory = "SystemManaged"/"Custom"
    EnableIndexing = $true/$false
    DisableAnimations = $true/$false
    DisableTransparency = $true/$false
}
```

| 項目 | 型 | 説明 | 選択肢 |
|-----|----|----- |--------|
| `VisualEffects` | string | 視覚効果設定 | Performance, Appearance, Custom |
| `VirtualMemory` | string | 仮想メモリ管理 | SystemManaged, Custom |
| `EnableIndexing` | bool | ファイル検索インデックス | true（利便性）, false（軽量化） |
| `DisableAnimations` | bool | アニメーション無効化 | true（軽量化） |
| `DisableTransparency` | bool | 透明効果無効化 | true（軽量化） |

### ドメイン参加設定

```powershell
DomainSettings = @{
    JoinDomain = $true/$false
    DomainName = "domain.local"
    DomainUser = "domain-join-account"
    DomainPassword = "DomainPassword"
    MachineObjectOU = "OU=Computers,DC=domain,DC=local"
}
```

| 項目 | 型 | 必須 | 説明 |
|-----|----|----|------|
| `JoinDomain` | bool | ○ | ドメイン参加の有効化 |
| `DomainName` | string | △ | ドメイン名（FQDN） |
| `DomainUser` | string | △ | ドメイン参加用アカウント |
| `DomainPassword` | string | △ | ドメイン参加用パスワード |
| `MachineObjectOU` | string | × | コンピューターオブジェクトのOU |

#### 環境別推奨設定

##### Enterprise環境
```powershell
Management = @{
    EnableRemoteDesktop = $true    # リモート管理必須
    
    ConfigureEventLogs = @{
        MaxLogSize = 104857600     # 100MB（詳細監査）
        RetentionDays = 90         # 3ヶ月保存
    }
    
    PerformanceSettings = @{
        VisualEffects = "Performance"
        VirtualMemory = "SystemManaged"
        EnableIndexing = $true      # 利便性重視
        DisableAnimations = $false
        DisableTransparency = $false
    }
    
    # ドメイン参加設定例
    DomainSettings = @{
        JoinDomain = $true
        DomainName = "company.local"
        DomainUser = "domain-join"
        DomainPassword = "DomainJoinPassword!"
        MachineObjectOU = "OU=Workstations,OU=Company,DC=company,DC=local"
    }
}
```

##### Development環境
```powershell
Management = @{
    EnableRemoteDesktop = $true
    
    ConfigureEventLogs = @{
        MaxLogSize = 52428800      # 50MB
        RetentionDays = 30         # 1ヶ月
    }
    
    PerformanceSettings = @{
        VisualEffects = "Performance"  # 開発パフォーマンス重視
        VirtualMemory = "SystemManaged"
        EnableIndexing = $true         # コード検索有効
        DisableAnimations = $false
        DisableTransparency = $false
    }
    
    DomainSettings = @{
        JoinDomain = $false        # 開発環境は独立
    }
}
```

##### Minimal環境
```powershell
Management = @{
    EnableRemoteDesktop = $false   # セキュリティ重視
    
    ConfigureEventLogs = @{
        MaxLogSize = 20971520      # 20MB（最小限）
        RetentionDays = 7          # 1週間
    }
    
    PerformanceSettings = @{
        VisualEffects = "Performance"  # 最高パフォーマンス
        VirtualMemory = "SystemManaged"
        EnableIndexing = $false        # 軽量化重視
        DisableAnimations = $true      # すべて無効化
        DisableTransparency = $true
    }
    
    DomainSettings = @{
        JoinDomain = $false
    }
}
```

---

## カスタム設定

### CustomSettings セクション

プリセット固有のメタデータと追加設定を定義します。

#### 基本構造

```powershell
CustomSettings = @{
    Description = "設定の説明"
    Version = "1.0.0"
    LastModified = "2025-01-22"
    CreatedBy = "作成者名"
    
    Environment = @{ ... }
    Optimizations = @{ ... }      # Development/Minimal用
    Compliance = @{ ... }         # Enterprise用
}
```

#### 基本メタデータ

| 項目 | 型 | 説明 | 例 |
|-----|----|----- |----|
| `Description` | string | 設定の説明 | "Enterprise環境向け設定" |
| `Version` | string | バージョン番号 | "1.0.0" |
| `LastModified` | string | 最終更新日 | "2025-01-22" |
| `CreatedBy` | string | 作成者 | "System Administrator" |

### 環境情報

```powershell
Environment = @{
    Type = "Enterprise"/"Development"/"Minimal"/"Custom"
    Purpose = "用途説明"
    Features = @("機能1", "機能2", ...)
    Characteristics = @("特徴1", "特徴2", ...)
}
```

### 最適化設定（Development/Minimal環境）

```powershell
Optimizations = @{
    DisableStartupPrograms = $true/$false
    ConfigurePageFile = $true/$false
    EnableHighPerformanceMode = $true/$false
    DisableUnnecessaryServices = $true/$false
}
```

### コンプライアンス設定（Enterprise環境）

```powershell
Compliance = @("ISO27001", "SOX", "GDPR", ...)
```

---

## 設定値リファレンス表

### 主要設定項目クイックリファレンス

| 設定項目 | Enterprise | Development | Minimal | 説明 |
|---------|-----------|-------------|---------|------|
| **システム** | | | | |
| IPv6無効化 | ✓ | × | ✓ | IPv6プロトコル無効化 |
| Firewall無効化 | ✓ | ✓ | × | Windows Firewall無効化 |
| Bluetooth無効化 | ✓ | × | ✓ | Bluetoothサービス無効化 |
| **ユーザー** | | | | |
| 管理者アカウント数 | 3-4 | 2-3 | 2 | 作成する管理者アカウント数 |
| Administrator無効化 | ✓ | ✓ | ✓ | ビルトインAdministrator無効 |
| **アプリケーション** | | | | |
| .NET Framework 3.5 | ✓ | ✓ | × | レガシーアプリ対応 |
| 既定ブラウザー | Edge | Chrome | Edge | 既定Webブラウザー |
| Officeテレメトリ無効 | ✓ | × | ✓ | Office使用状況送信無効 |
| **Windows機能** | | | | |
| Hyper-V | × | ✓ | × | 仮想化機能 |
| WSL | × | ✓ | × | Linux開発環境 |
| Windows Sandbox | × | ✓ | × | セキュアテスト環境 |
| Cortana無効化 | ✓ | × | ✓ | Cortana音声アシスタント |
| **セキュリティ** | | | | |
| UAC無効化 | × | × | × | ユーザーアカウント制御 |
| 機能更新延期（日） | 180 | 365 | 365 | Windows機能更新の延期 |
| 品質更新延期（日） | 30 | 90 | 7 | セキュリティ更新の延期 |
| テレメトリ無効化 | ✓ | × | ✓ | 使用状況データ送信無効 |
| **管理** | | | | |
| リモートデスクトップ | ✓ | ✓ | × | RDP接続許可 |
| 最大ログサイズ（MB） | 100 | 50 | 20 | イベントログサイズ |
| ドメイン参加 | 設定可能 | × | × | Active Directory参加 |

### パフォーマンス影響度

| 設定項目 | CPU負荷 | メモリ使用量 | ストレージI/O | 起動時間 |
|---------|---------|-------------|--------------|---------|
| IPv6無効化 | ↓ | ↓ | - | ↓ |
| Bluetooth無効化 | ↓ | ↓ | - | ↓ |
| Hyper-V有効化 | ↑ | ↑↑ | ↑ | ↑ |
| WSL有効化 | ↑ | ↑ | ↑ | ↑ |
| Windows Search無効化 | ↓ | ↓ | ↓↓ | ↓ |
| 視覚効果無効化 | ↓ | ↓ | - | ↓ |
| テレメトリ無効化 | ↓ | ↓ | ↓ | ↓ |

凡例: ↑↑大幅増加, ↑増加, -変化なし, ↓減少, ↓↓大幅減少

---

## 設定のカスタマイズ方法

### Step 1: 既存プリセットの選択

まず最も近い要件のプリセットを選択します：

```powershell
# 基準プリセットの確認
.\Generate-UnattendXML.ps1 -PresetName Enterprise -WhatIf

# または内容の詳細確認
Import-PowerShellDataFile -Path ".\Configs\Presets\Enterprise.psd1"
```

### Step 2: プリセットのコピーとカスタマイズ

```powershell
# 既存プリセットをコピー
Copy-Item ".\Configs\Presets\Enterprise.psd1" ".\MyCustom.psd1"

# テキストエディターで編集
# または PowerShellスクリプトで動的生成
```

### Step 3: 段階的カスタマイズの例

#### 例1: ホスト名とユーザーのみ変更

```powershell
# custom-simple.psd1
# Enterpriseプリセットベースで最小限の変更

$baseConfig = Import-PowerShellDataFile -Path ".\Configs\Presets\Enterprise.psd1"

# ホスト名変更
$baseConfig.System.HostName = "MYCORP-PC-001"

# 追加ユーザー
$baseConfig.Users += @{
    Name = "mycorp-admin"
    Password = "MyCorp2025!"
    Groups = @("Administrators", "Users")
    DisplayName = "My Corporation Admin"
}

# ファイル出力（手動実装が必要）
```

#### 例2: 開発者向けカスタマイズ

```powershell
# custom-developer.psd1
@{
    # Developmentベースに追加カスタマイズ
    System = @{
        HostName = "DEV-WORKSTATION"
        TimeZone = "Tokyo Standard Time"
        DisableIPv6 = $false
        DisableFirewall = $true
        DisableBluetooth = $false
        MuteAudio = $false
    }
    
    Users = @(
        @{ Name = "Administrator"; IsEnabled = $false },
        @{
            Name = "senior-dev"
            Password = "SeniorDev2025!"
            Groups = @("Administrators", "Users")
            DisplayName = "Senior Developer"
        },
        @{
            Name = "junior-dev"  
            Password = "JuniorDev2025!"
            Groups = @("Users", "Remote Desktop Users")
            DisplayName = "Junior Developer"
        }
    )
    
    # 開発者向け追加設定
    Applications = @{
        EnableDotNet35 = $true
        DefaultBrowser = "ChromeHTML"
        
        # 開発者向けOffice設定
        OfficeSettings = @{
            SkipFirstRun = $true
            AcceptEula = $true
            DisableTelemetry = $false  # フィードバック有効
            EnableMacros = $true       # VBA開発用
        }
    }
    
    WindowsFeatures = @{
        EnableDotNet35 = $true
        EnableHyperV = $true
        EnableWSL = $true
        EnableWindowsSandbox = $true
        DisableCortana = $false
        
        # 追加の開発者向け機能
        Capabilities = @{
            "OpenSSH.Client" = "Enabled"
            "OpenSSH.Server" = "Enabled"
            "PowerShell.ISE" = "Enabled"
        }
    }
    
    # 開発者向けカスタム設定
    DeveloperSettings = @{
        # Git設定
        Git = @{
            DefaultEditor = "code"
            DefaultBranch = "main"
            EnableCredentialHelper = $true
        }
        
        # 開発ツール設定
        Tools = @{
            InstallVSCode = $true
            InstallGit = $true
            InstallNodeJS = $true
            InstallPython = $true
        }
        
        # パフォーマンス設定
        Performance = @{
            MaxConcurrentBuilds = 4
            EnableFastBoot = $true
            OptimizeSSD = $true
        }
    }
}
```

#### 例3: 部署固有設定の動的生成

```powershell
# generate-department-config.ps1
# 部署情報から動的に設定を生成

param(
    [Parameter(Mandatory = $true)]
    [string]$Department,
    
    [Parameter(Mandatory = $true)]
    [int]$StartPC,
    
    [Parameter(Mandatory = $true)]
    [int]$EndPC
)

# 部署別基本設定
$DepartmentSettings = @{
    "Sales" = @{
        SecurityLevel = "Medium"
        AllowedSoftware = @("Office", "CRM", "PDF Reader")
        RestrictedFeatures = @("Hyper-V", "WSL", "Developer Mode")
        DefaultApps = @{
            Browser = "MSEdgeHTM"
            Mail = "Outlook.File.msg.15"
        }
    }
    
    "Engineering" = @{
        SecurityLevel = "Low"
        AllowedSoftware = @("Visual Studio", "Docker", "Git")
        EnabledFeatures = @("Hyper-V", "WSL", "Developer Mode")
        DefaultApps = @{
            Browser = "ChromeHTML" 
            Mail = "Outlook.File.msg.15"
        }
    }
    
    "HR" = @{
        SecurityLevel = "High"
        AllowedSoftware = @("Office", "PDF Reader")
        RestrictedFeatures = @("All Development Tools")
        DefaultApps = @{
            Browser = "MSEdgeHTM"
            Mail = "Outlook.File.msg.15"
        }
    }
}

$deptConfig = $DepartmentSettings[$Department]

for ($i = $StartPC; $i -le $EndPC; $i++) {
    $pcNumber = "{0:D3}" -f $i
    $hostName = "$Department-PC-$pcNumber"
    
    $config = @{
        System = @{
            HostName = $hostName
            TimeZone = "Tokyo Standard Time"
            DisableIPv6 = $true
            DisableFirewall = ($deptConfig.SecurityLevel -eq "Low")
            DisableBluetooth = ($deptConfig.SecurityLevel -ne "Low")
        }
        
        Users = @(
            @{ Name = "Administrator"; IsEnabled = $false },
            @{
                Name = "$($Department.ToLower())-admin"
                Password = "$($Department)Admin2025!"
                Groups = @("Administrators", "Users")
                DisplayName = "$Department Administrator"
            }
        )
        
        Applications = @{
            DefaultBrowser = $deptConfig.DefaultApps.Browser
            DefaultMailClient = $deptConfig.DefaultApps.Mail
        }
        
        CustomSettings = @{
            Department = $Department
            SecurityLevel = $deptConfig.SecurityLevel
            AllowedSoftware = $deptConfig.AllowedSoftware
            GeneratedDate = Get-Date -Format "yyyy-MM-dd"
        }
    }
    
    # PSD1形式でファイル出力
    $outputFile = "$Department-$pcNumber.psd1"
    # 実際のファイル出力処理は省略（ConvertTo-PSD1関数などが必要）
    
    Write-Host "設定生成完了: $outputFile" -ForegroundColor Green
}
```

### Step 4: 設定の検証とテスト

```powershell
# カスタム設定の検証
function Test-CustomConfiguration {
    param([string]$ConfigPath)
    
    try {
        # 設定ファイルの読み込みテスト
        $config = Import-PowerShellDataFile -Path $ConfigPath
        
        # 必須項目の確認
        $requiredSections = @("System", "Users")
        foreach ($section in $requiredSections) {
            if (-not $config.ContainsKey($section)) {
                throw "必須セクションが不足: $section"
            }
        }
        
        # ホスト名の妥当性確認
        if ($config.System.HostName -match "[^a-zA-Z0-9\-]") {
            Write-Warning "ホスト名に無効な文字が含まれています: $($config.System.HostName)"
        }
        
        # ユーザー設定の確認
        $adminUsers = $config.Users | Where-Object { $_.Groups -contains "Administrators" -and $_.Name -ne "Administrator" }
        if ($adminUsers.Count -eq 0) {
            Write-Warning "管理者アカウントが設定されていません"
        }
        
        Write-Host "✅ 設定検証成功: $ConfigPath" -ForegroundColor Green
        return $true
    }
    catch {
        Write-Host "❌ 設定検証失敗: $ConfigPath - $_" -ForegroundColor Red
        return $false
    }
}

# 使用例
Test-CustomConfiguration -ConfigPath ".\MyCustom.psd1"
```

---

*この設定リファレンスガイドは、Windows 11 Sysprep応答ファイル自動生成システム（PowerShell版）のすべての設定項目と、その適切な使用方法について詳細に説明しています。環境に応じた最適な設定選択の参考としてご活用ください。*