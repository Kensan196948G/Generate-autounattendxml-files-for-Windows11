# インストール手順書

## 📋 システム要件

### 最小要件
- **OS**: Windows 10/11（64ビット）
- **CPU**: 2コア以上
- **メモリ**: 4GB以上
- **ディスク**: 1GB以上の空き容量
- **ネットワーク**: インターネット接続（初回セットアップ時）

### 推奨要件
- **OS**: Windows 11 22H2以降
- **CPU**: 4コア以上
- **メモリ**: 8GB以上
- **ディスク**: 5GB以上の空き容量

### 必須ソフトウェア
- **Python**: 3.10以降
- **Node.js**: 18.0以降
- **PowerShell**: 5.1以降
- **Git**: 2.30以降（オプション）

---

## 🚀 クイックインストール

### 1. 最速セットアップ（推奨）

```powershell
# 管理者権限でPowerShellを開く
# プロジェクトフォルダに移動
cd E:\Generate-autounattendxml-files-for-Windows11\WebUI

# ワンクリック起動スクリプトを実行
.\Start-WebUI.ps1
```

これで自動的に以下が実行されます：
- 依存関係のインストール
- バックエンドサーバーの起動（ポート8081）
- フロントエンドサーバーの起動（ポート3050）
- ブラウザの自動起動

---

## 📦 詳細インストール手順

### 1. リポジトリの取得

#### Gitを使用する場合
```powershell
git clone https://github.com/your-org/Generate-autounattendxml-files-for-Windows11.git
cd Generate-autounattendxml-files-for-Windows11
```

#### ZIPファイルの場合
1. GitHubからZIPファイルをダウンロード
2. 任意のフォルダに展開
3. PowerShellで展開したフォルダに移動

### 2. Python環境のセットアップ

```powershell
# Pythonのバージョン確認
python --version  # 3.10以上であることを確認

# 仮想環境の作成（推奨）
cd WebUI\backend
python -m venv venv

# 仮想環境の有効化
.\venv\Scripts\Activate.ps1

# 依存パッケージのインストール
pip install -r requirements.txt
```

#### 主要なPythonパッケージ
- `fastapi==0.104.1` - WebAPIフレームワーク
- `uvicorn==0.24.0` - ASGIサーバー
- `pydantic==2.5.0` - データバリデーション
- `lxml==4.9.3` - XML処理
- `python-multipart==0.0.6` - ファイルアップロード

### 3. Node.js環境のセットアップ

```powershell
# Node.jsのバージョン確認
node --version  # 18.0以上であることを確認
npm --version   # 9.0以上であることを確認

# フロントエンドディレクトリに移動
cd ..\frontend

# 依存パッケージのインストール
npm install

# ビルド（本番環境の場合）
npm run build
```

#### 主要なNode.jsパッケージ
- `next@14.0.4` - Reactフレームワーク
- `react@18.2.0` - UIライブラリ
- `typescript@5.3.3` - 型安全性
- `tailwindcss@3.4.0` - CSSフレームワーク
- `axios@1.6.5` - HTTP通信

### 4. 実行ポリシーの設定

PowerShellスクリプトを実行するために必要：

```powershell
# 現在のポリシーを確認
Get-ExecutionPolicy

# スクリプト実行を許可（管理者権限必要）
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

---

## 🔧 起動方法

### 方法1: 統合起動スクリプト（推奨）

```powershell
cd E:\Generate-autounattendxml-files-for-Windows11\WebUI
.\Start-WebUI.ps1
```

### 方法2: 個別起動

#### バックエンドの起動
```powershell
cd WebUI\backend
python main.py
# または
.\Start-Backend-8081.ps1
```

#### フロントエンドの起動
```powershell
cd WebUI\frontend
npm run dev
# または
.\Start-Frontend.ps1
```

### 方法3: バッチファイルでの起動

```batch
cd WebUI
Start-WebUI.bat
```

---

## 🌐 アクセス方法

起動後、以下のURLでアクセス可能：

- **フロントエンド（WebUI）**: http://localhost:3050
- **バックエンドAPI**: http://localhost:8081
- **API仕様書（Swagger）**: http://localhost:8081/api/docs

ネットワーク内の他のPCからアクセスする場合：
- http://[サーバーのIPアドレス]:3050

---

## ⚙️ 環境変数の設定（オプション）

### システム環境変数
```powershell
# Pythonパスの追加
[Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\Python310", "User")

# Node.jsパスの追加
[Environment]::SetEnvironmentVariable("Path", "$env:Path;C:\Program Files\nodejs", "User")
```

### プロジェクト固有の環境変数
```powershell
# .envファイルの作成
@"
API_PORT=8081
FRONTEND_PORT=3050
API_BASE_URL=http://localhost:8081
"@ | Out-File -FilePath "WebUI\.env" -Encoding UTF8
```

---

## 🔍 インストール確認

### 1. 依存関係の確認

```powershell
# Pythonパッケージ
pip list | Select-String "fastapi|uvicorn|pydantic"

# Node.jsパッケージ
npm list --depth=0
```

### 2. ポートの確認

```powershell
# 使用中のポート確認
netstat -an | Select-String "3050|8081"
```

### 3. 動作確認

```powershell
# バックエンドのヘルスチェック
Invoke-RestMethod -Uri "http://localhost:8081/api/health"

# フロントエンドの確認
Start-Process "http://localhost:3050"
```

---

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. PowerShell実行ポリシーエラー
```powershell
# エラー: スクリプトの実行が無効になっています
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process -Force
```

#### 2. ポート使用中エラー
```powershell
# ポート8081が使用中の場合
.\WebUI\Quick-Fix-Ports.ps1
```

#### 3. Pythonモジュールが見つからない
```powershell
# 仮想環境の再作成
cd WebUI\backend
Remove-Item venv -Recurse -Force
python -m venv venv
.\venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

#### 4. Node.jsモジュールエラー
```powershell
# node_modulesの再インストール
cd WebUI\frontend
Remove-Item node_modules -Recurse -Force
Remove-Item package-lock.json -Force
npm install
```

#### 5. ファイアウォールブロック
```powershell
# Windows Defenderファイアウォールに例外追加
New-NetFirewallRule -DisplayName "WebUI Backend" -Direction Inbound -LocalPort 8081 -Protocol TCP -Action Allow
New-NetFirewallRule -DisplayName "WebUI Frontend" -Direction Inbound -LocalPort 3050 -Protocol TCP -Action Allow
```

---

## 📝 設定ファイル

### backend/main.py の設定
```python
# ポート設定
PORT = 8081
HOST = "0.0.0.0"  # 全インターフェースでリッスン

# CORS設定
ALLOWED_ORIGINS = [
    "http://localhost:3050",
    "http://localhost:3000",
]
```

### frontend/next.config.js の設定
```javascript
module.exports = {
  reactStrictMode: true,
  env: {
    API_BASE_URL: process.env.API_BASE_URL || 'http://localhost:8081',
  },
}
```

---

## 🚀 本番環境へのデプロイ

### 1. ビルド
```powershell
# フロントエンドのビルド
cd WebUI\frontend
npm run build

# Pythonアプリケーションのパッケージング
cd ..\backend
pip freeze > requirements_production.txt
```

### 2. サービス登録（Windows）
```powershell
# NSSMを使用したサービス登録
nssm install "WebUI-Backend" "C:\Python310\python.exe" "E:\Generate-autounattendxml-files-for-Windows11\WebUI\backend\main.py"
nssm install "WebUI-Frontend" "C:\Program Files\nodejs\node.exe" "E:\Generate-autounattendxml-files-for-Windows11\WebUI\frontend\node_modules\next\dist\bin\next" "start"
```

### 3. IISでのホスティング（オプション）
- URL Rewriteモジュールのインストール
- Application Request Routing (ARR)の設定
- リバースプロキシの構成

---

## 📊 パフォーマンス最適化

### Python最適化
```powershell
# Pythonバイトコードの事前コンパイル
python -m compileall WebUI\backend

# uvicornワーカー数の調整
uvicorn main:app --workers 4
```

### Node.js最適化
```powershell
# 本番モードでの起動
$env:NODE_ENV = "production"
npm run start
```

---

## 🔐 セキュリティ設定

### HTTPS化（推奨）
```powershell
# 自己署名証明書の作成
New-SelfSignedCertificate -DnsName "localhost" -CertStoreLocation "cert:\LocalMachine\My"

# uvicornでHTTPS有効化
uvicorn main:app --ssl-keyfile key.pem --ssl-certfile cert.pem
```

### アクセス制限
```powershell
# 特定IPのみ許可
New-NetFirewallRule -DisplayName "WebUI Restricted" -Direction Inbound -LocalPort 8081 -Protocol TCP -RemoteAddress "192.168.1.0/24" -Action Allow
```

---

## 📚 参考リンク

- [Python公式サイト](https://www.python.org/)
- [Node.js公式サイト](https://nodejs.org/)
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Next.js公式ドキュメント](https://nextjs.org/docs)

---

*最終更新: 2024年8月24日*